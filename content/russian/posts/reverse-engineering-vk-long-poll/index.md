---
title: "–†–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ Long Poll –í–ö–æ–Ω—Ç–∞–∫—Ç–µ: —Å–Ω–∏—Ñ—Ñ–µ—Ä, —Å–∫—Ä—ã—Ç—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ WebSocket"
date: 2026-02-04T13:52:09+03:00
lastmod: 2026-02-04T13:52:09+03:00
author: Rianvy
avatar: /img/avatar.jpg
cover: Cover.png
images:
   - Cover.png
categories:
  - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
  - –†–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥
tags:
  - Javascript
  - VK-api
  - Long-poll
  - Websocket
  - Reverse-engineering
  - Browser-extension
  - –°–Ω–∏—Ñ—Ñ–µ—Ä
  - –ü–µ—Ä–µ—Ö–≤–∞—Ç-—Ç—Ä–∞—Ñ–∏–∫–∞
description: "–†–∞–∑–±–∏—Ä–∞—é—Å—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Long Poll –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –ø–∏—à—É —Å–Ω–∏—Ñ—Ñ–µ—Ä –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–æ–±—ã—Ç–∏–π –∏ –Ω–∞—Ö–æ–∂—É –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã. –ë–æ–Ω—É—Å: –∑–∞–≥–∞–¥–∫–∞ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–æ–≤ –∏ WebSocket."
keywords:
  - VK Long Poll
  - –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–æ–±—ã—Ç–∏–π VK
  - —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
  - VK API —Å–æ–±—ã—Ç–∏—è
  - –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ VK
---

–†–∞–∑–±–∏—Ä–∞—é—Å—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Long Poll –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –ø–∏—à—É —Å–Ω–∏—Ñ—Ñ–µ—Ä –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —Å–æ–±—ã—Ç–∏–π –∏ –Ω–∞—Ö–æ–∂—É –Ω–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã.

<!--more-->

## –í–≤–µ–¥–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ —è —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª –±—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ VKify –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –ø–µ—Ä–µ–¥–æ –º–Ω–æ–π –≤—Å—Ç–∞–ª–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∑–∞–¥–∞—á–∞: **–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –∫—Ç–æ –ø–µ—á–∞—Ç–∞–µ—Ç, –∫—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫—Ç–æ —É–¥–∞–ª–∏–ª –µ–≥–æ.

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK API –ø–æ Long Poll —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –æ–Ω–∞ –Ω–µ–ø–æ–ª–Ω–∞—è –∏ –º–µ—Å—Ç–∞–º–∏ —É—Å—Ç–∞—Ä–µ–ª–∞. –ú–Ω–æ–≥–∏–µ –∫–æ–¥—ã —Å–æ–±—ã—Ç–∏–π –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã, –∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –æ–ø–∏—Å–∞–Ω–Ω–æ–π. –ü—Ä–∏—à–ª–æ—Å—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

–í —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ —Ä–∞—Å—Å–∫–∞–∂—É:
- –ß—Ç–æ —Ç–∞–∫–æ–µ Long Poll –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω
- –ö–∞–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ö–∞–∫ —è –Ω–∞–ø–∏—Å–∞–ª —Å–Ω–∏—Ñ—Ñ–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—ã—Ç–∏–π
- –ö–∞–∫–∏–µ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª (—Å–ø–æ–π–ª–µ—Ä: –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å, –≤–æ–∑–º–æ–∂–Ω–æ, –∏–¥—ë—Ç —á–µ—Ä–µ–∑ WebSocket)
- –ì–æ—Ç–æ–≤—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ Long Poll?

**Long Polling** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ —Å–µ—Ä–≤–µ—Ä **–¥–µ—Ä–∂–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º**, –ø–æ–∫–∞ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ –∏—Å—Ç–µ—á—ë—Ç —Ç–∞–π–º–∞—É—Ç.

–í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Long Poll –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π:
- –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°—Ç–∞—Ç—É—Å—ã "–ø–µ—á–∞—Ç–∞–µ—Ç..."
- –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ

–ó–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ endpoint –≤–∏–¥–∞:

```
https://api.vk.com/ruimXXXXXXXXX?version=21&mode=682
```

–ì–¥–µ `XXXXXXXXX` ‚Äî –≤–∞—à user ID.

---

## –®–∞–≥ 1: –ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–≤–∞—Ç fetch

–ù–∞—á–Ω—ë–º —Å –±–∞–∑–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞. –ò–¥–µ—è –ø—Ä–æ—Å—Ç–∞—è: –ø–æ–¥–º–µ–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `fetch`, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∏—Ö –¥–∞–ª—å—à–µ.

```javascript
/**
 * –ë–∞–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ Long Poll
 * –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ VK
 */
(function() {
  const originalFetch = window.fetch;

  window.fetch = async function(url, options) {
    const response = await originalFetch.apply(this, arguments);
    const urlStr = url?.toString() || '';

    // –õ–æ–≤–∏–º —Ç–æ–ª—å–∫–æ Long Poll –∑–∞–ø—Ä–æ—Å—ã
    if (/api\.vk\.com\/ruim/.test(urlStr)) {
      try {
        const clone = response.clone();
        const data = await clone.json();

        if (data.updates && data.updates.length > 0) {
          console.log('[Long Poll] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π:', data.updates.length);
          data.updates.forEach(update => {
            console.log('  –ö–æ–¥:', update[0], '| –î–∞–Ω–Ω—ã–µ:', update.slice(1));
          });
        }
      } catch (e) {}
    }

    return response;
  };

  console.log('‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ Long Poll –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
})();
```

–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console) –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å—Å—è. –í—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π.

---

## –®–∞–≥ 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Å–Ω–∏—Ñ—Ñ–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–ü—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ —Ö–æ—Ä–æ—à –¥–ª—è –Ω–∞—á–∞–ª–∞, –Ω–æ –º–Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ. –Ø –Ω–∞–ø–∏—Å–∞–ª –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–Ω–∏—Ñ—Ñ–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

- –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –∫–æ–¥—É —Å–æ–±—ã—Ç–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

```javascript
/**
 * VK Long Poll Event Sniffer
 * –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—ã—Ç–∏–π
 * 
 * –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –≤–≤–µ–¥–∏—Ç–µ __sniffer.help() –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
 */
(function() {
  'use strict';

  if (window.__vkEventSniffer) {
    console.log('[Sniffer] –£–∂–µ –∑–∞–ø—É—â–µ–Ω. –ö–æ–º–∞–Ω–¥—ã: __sniffer.help()');
    return;
  }

  // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±—ã—Ç–∏–π
  const eventCodes = new Map(); // code -> { count, samples, lastSeen }
  let totalEvents = 0;
  let isRunning = true;

  const originalFetch = window.fetch;

  window.fetch = async function(url, options) {
    const response = await originalFetch.apply(this, arguments);

    if (!isRunning) return response;

    const urlStr = url?.toString() || '';

    if (/api\.vk\.com\/ruim/.test(urlStr)) {
      try {
        const clone = response.clone();
        const data = await clone.json();

        if (data.updates?.length > 0) {
          console.groupCollapsed(
            `%c[Long Poll]%c ${data.updates.length} —Å–æ–±—ã—Ç–∏–π`,
            'background: #5181b8; color: white; padding: 2px 8px; border-radius: 4px;',
            'color: #666; margin-left: 8px;'
          );

          data.updates.forEach(update => {
            const code = update[0];

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (!eventCodes.has(code)) {
              eventCodes.set(code, { count: 0, samples: [], lastSeen: null });
              // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –Ω–æ–≤–æ–º —Ç–∏–ø–µ —Å–æ–±—ã—Ç–∏—è
              console.log(
                `%cüÜï –û–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–æ–≤—ã–π –∫–æ–¥ —Å–æ–±—ã—Ç–∏—è: ${code}%c`,
                'background: #4CAF50; color: white; padding: 2px 8px; border-radius: 4px; font-weight: bold;',
                ''
              );
            }
            
            const stats = eventCodes.get(code);
            stats.count++;
            stats.lastSeen = new Date().toLocaleTimeString();
            if (stats.samples.length < 5) {
              stats.samples.push([...update]);
            }
            totalEvents++;

            // –í—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å
            console.log(`üì® Code ${code}:`, update.slice(1));
          });

          console.groupEnd();
        }
      } catch (e) {}
    }

    return response;
  };

  // API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  window.__sniffer = {
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–¥—ã
    codes() {
      if (eventCodes.size === 0) {
        console.log('%c‚ö†Ô∏è –ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.%c\n\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã:\n1. –ù–∞—Ö–æ–¥–∏—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ VK\n2. –û—Ç–∫—Ä—ã–ª–∏ –¥–∏–∞–ª–æ–≥ —Å –∫–µ–º-—Ç–æ\n3. –ü–æ–ª—É—á–∞–µ—Ç–µ/–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è', 
          'color: #FF9800; font-weight: bold;', '');
        return;
      }
      
      console.log('%c\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π\n', 'font-size: 14px; font-weight: bold;');
      
      const sorted = [...eventCodes.entries()].sort((a, b) => b[1].count - a[1].count);
      
      console.table(sorted.map(([code, stats]) => ({
        '–ö–æ–¥': code,
        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': stats.count,
        '–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑': stats.lastSeen,
        '–ü—Ä–∏–º–µ—Ä (–ø–µ—Ä–≤—ã–µ 4 —ç–ª–µ–º–µ–Ω—Ç–∞)': JSON.stringify(stats.samples[0]?.slice(0, 4) || [])
      })));
      
      console.log(`\n–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π: ${totalEvents}`);
      console.log(`–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤: ${eventCodes.size}`);
      return sorted;
    },

    // –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–¥–∞
    inspect(code) {
      const stats = eventCodes.get(code);
      if (!stats) {
        console.log(`‚ùå –ö–æ–¥ ${code} –Ω–µ –Ω–∞–π–¥–µ–Ω.`);
        if (eventCodes.size > 0) {
          console.log(`–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–¥—ã:`, [...eventCodes.keys()].join(', '));
        } else {
          console.log('–ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –∏–ª–∏ —Å–ø—Ä–æ–≤–æ—Ü–∏—Ä—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–º—É-–Ω–∏–±—É–¥—å).');
        }
        return;
      }
      
      console.log(`%c\nüîç –ê–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏—è ${code}\n`, 'font-size: 14px; font-weight: bold;');
      console.log(`–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ: ${stats.count}`);
      console.log(`–ü–æ—Å–ª–µ–¥–Ω–µ–µ: ${stats.lastSeen}\n`);
      
      console.log('–ü—Ä–∏–º–µ—Ä—ã (–¥–æ 5 —à—Ç—É–∫):');
      stats.samples.forEach((sample, i) => {
        console.log(`\n#${i + 1}:`);
        sample.forEach((value, idx) => {
          const type = typeof value;
          const display = type === 'object' ? JSON.stringify(value) : value;
          console.log(`  [${idx}] (${type}): ${display}`);
        });
      });
      
      return stats;
    },

    // –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
    search(keyword) {
      if (eventCodes.size === 0) {
        console.log('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞.');
        return [];
      }
      
      const found = [];
      eventCodes.forEach((stats, code) => {
        stats.samples.forEach(sample => {
          if (JSON.stringify(sample).toLowerCase().includes(keyword.toLowerCase())) {
            found.push({ code, sample });
          }
        });
      });
      
      if (found.length === 0) {
        console.log(`–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –¥–ª—è "${keyword}"`);
      } else {
        console.log(`–ù–∞–π–¥–µ–Ω–æ ${found.length} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è "${keyword}":`, found);
      }
      return found;
    },

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    stop() { isRunning = false; console.log('‚è∏Ô∏è –°–Ω–∏—Ñ—Ñ–µ—Ä –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'); },
    start() { isRunning = true; console.log('‚ñ∂Ô∏è –°–Ω–∏—Ñ—Ñ–µ—Ä –∑–∞–ø—É—â–µ–Ω'); },
    clear() { eventCodes.clear(); totalEvents = 0; console.log('üóëÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞'); },
    
    // –≠–∫—Å–ø–æ—Ä—Ç
    export() {
      if (eventCodes.size === 0) {
        console.log('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.');
        return null;
      }
      
      const data = {
        exportedAt: new Date().toISOString(),
        totalEvents,
        events: Object.fromEntries(eventCodes)
      };
      console.log(JSON.stringify(data, null, 2));
      return data;
    },
    
    // –°—Ç–∞—Ç—É—Å
    status() {
      console.log(`
%cüìä –°—Ç–∞—Ç—É—Å —Å–Ω–∏—Ñ—Ñ–µ—Ä–∞%c
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ê–∫—Ç–∏–≤–µ–Ω: ${isRunning ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}
–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π: ${totalEvents}
–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤: ${eventCodes.size}
${eventCodes.size > 0 ? `–ö–æ–¥—ã: ${[...eventCodes.keys()].join(', ')}` : ''}
`,
        'font-weight: bold; font-size: 12px;', ''
      );
    },

    // –°–ø—Ä–∞–≤–∫–∞
    help() {
      console.log(`
%c‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           VK Long Poll Event Sniffer                       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù%c

%c–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:%c
1. –û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –æ—Ç–∫—Ä—ã—Ç–æ–π
2. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –∫–µ–º-–Ω–∏–±—É–¥—å  
3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–∞–º, –Ω–∞—á–∞—Ç—å –ø–µ—á–∞—Ç–∞—Ç—å –∏ —Ç.–¥.
4. –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

%c–ö–æ–º–∞–Ω–¥—ã:%c
  __sniffer.status()     ‚Äî –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–¥—ã
  __sniffer.codes()      ‚Äî –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
  __sniffer.inspect(63)  ‚Äî –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–±—ã—Ç–∏—è —Å –∫–æ–¥–æ–º 63
  __sniffer.search('id') ‚Äî –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
  __sniffer.export()     ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ JSON
  
%c–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:%c
  __sniffer.stop()       ‚Äî –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—Ç
  __sniffer.start()      ‚Äî –í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—Ç
  __sniffer.clear()      ‚Äî –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
`,
        'color: #5181b8; font-weight: bold;', '',
        'color: #4CAF50; font-weight: bold;', '',
        'color: #2196F3; font-weight: bold;', '',
        'color: #FF9800; font-weight: bold;', ''
      );
    }
  };

  window.__vkEventSniffer = true;

  console.log(`
%cüîç VK Event Sniffer –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!%c

%c–ß—Ç–æ –¥–∞–ª—å—à–µ:%c
‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –¥–∏–∞–ª–æ–≥ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
‚Ä¢ –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–∞–º —Å–æ–æ–±—â–µ–Ω–∏–µ
‚Ä¢ –°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

%c–ö–æ–º–∞–Ω–¥—ã:%c __sniffer.help() ‚Äî —Å–ø—Ä–∞–≤–∫–∞, __sniffer.status() ‚Äî —Å—Ç–∞—Ç—É—Å
`,
    'color: #5181b8; font-weight: bold; font-size: 14px;', '',
    'color: #4CAF50; font-weight: bold;', '',
    'background: #151515; padding: 2px 6px; border-radius: 3px;', ''
  );

})();
```

**–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:**
1. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ VK
2. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –∫–µ–º-–Ω–∏–±—É–¥—å
3. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –Ω–∞—á–∞—Ç—å –ø–µ—á–∞—Ç–∞—Ç—å –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
4. –°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –í–≤–µ–¥–∏—Ç–µ `__sniffer.codes()` —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –°–Ω–∏—Ñ—Ñ–µ—Ä –≤ –¥–µ–π—Å—Ç–≤–∏–∏

–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–Ω–∏—Ñ—Ñ–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ Long Poll —Å–æ–±—ã—Ç–∏—è. –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–∞–∫–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –æ–Ω –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π:

![–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–Ω–∏—Ñ—Ñ–µ—Ä–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞](img/gBMlhcMDqy.png)

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–Ω–æ, –∫–∞–∫ —Å–Ω–∏—Ñ—Ñ–µ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è. –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ `[Long Poll]` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π —Å –∏—Ö –∫–æ–¥–∞–º–∏ –∏ –¥–∞–Ω–Ω—ã–º–∏. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–¥—ã: `63` ‚Äî —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ "–ø–µ—á–∞—Ç–∞–µ—Ç", `10004` ‚Äî –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ò–º–µ–Ω–Ω–æ —Ç–∞–∫ —è –∏ —Å–æ–±–∏—Ä–∞–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è.

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –Ω–∞–∫–æ–ø–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö, –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `__sniffer.codes()` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

![–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–æ–º–∞–Ω–¥—ã __sniffer.codes()](img/chrome_3RKqYYXFj5.png)

–¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–æ–¥—ã —Å–æ–±—ã—Ç–∏–π, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∫–∞–∂–¥—ã–π –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è, –∫–æ–≥–¥–∞ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑, –∏ –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–∞—â–µ –≤—Å–µ–≥–æ –∏ –Ω–∞ –∫–∞–∫–∏–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ.

---

## –®–∞–≥ 3: –ß—Ç–æ —è –æ–±–Ω–∞—Ä—É–∂–∏–ª

–ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –¥—Ä—É–≥–∞ (—Å–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç–µ—Ä–ø–µ–ª –º–æ–∏ "–Ω–∞–ø–∏—à–∏ –º–Ω–µ", "—É–¥–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ", "–≤—ã–π–¥–∏ –∏–∑ —Å–µ—Ç–∏") —è —Å–æ—Å—Ç–∞–≤–∏–ª –∫–∞—Ä—Ç—É —Å–æ–±—ã—Ç–∏–π.

### –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (—Ä–∞–±–æ—Ç–∞—é—Ç)

| –ö–æ–¥ | –°–æ–±—ã—Ç–∏–µ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ |
|-----|---------|-----------|
| **63** | –ü–µ—á–∞—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ | `[63, userId, [chatIds], flag, peerId]` |
| **64** | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ | `[64, userId, [chatIds], flag, timestamp]` |
| **52** | –ó–∞—è–≤–∫–∞ –≤ –¥—Ä—É–∑—å—è | `[52, type, userId, ?]` |
| **90** | –î–µ–π—Å—Ç–≤–∏—è –¥—Ä—É–∑–µ–π | `[90, actionType, userId]` |

### –°–æ–±—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (10000+)

| –ö–æ–¥ | –°–æ–±—ã—Ç–∏–µ | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ |
|-----|---------|-----------|
| **10002** | –£–¥–∞–ª–∏–ª –¥–ª—è –≤—Å–µ—Ö | `[10002, ?, flags, peerId, localId]` |
| **10004** | –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | `[10004, ?, flags, ?, fromId, peerId, text, {...}]` |
| **10005** | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | `[10005, ?, flags, fromId, timestamp, text, {...}]` |
| **10007** | –ü—Ä–æ—á–∏—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ | `[10007, peerId, ?, ?, msgId]` |

### –ü–æ–¥–∫–æ–¥—ã —Å–æ–±—ã—Ç–∏—è 90 (–¥—Ä—É–∑—å—è)

| –ü–æ–¥–∫–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| 1 | –û—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è |
| 2 | –ü—Ä–∏–Ω—è–ª –≤–∞—à—É –∑–∞—è–≤–∫—É |
| 3 | –£–¥–∞–ª–∏–ª –≤–∞—Å –∏–∑ –¥—Ä—É–∑–µ–π |

---

## –®–∞–≥ 4: –ó–∞–≥–∞–¥–∫–∞ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞

–ü–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, —Å–æ–±—ã—Ç–∏—è **8** (–æ–Ω–ª–∞–π–Ω) –∏ **9** (–æ—Ñ—Ñ–ª–∞–π–Ω) –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Long Poll. –ù–æ —è –∏—Ö –Ω–µ –≤–∏–¥–µ–ª!

–†–∞—Å—à–∏—Ä–∏–ª –ø–æ–∏—Å–∫ –∏ –Ω–∞—á–∞–ª –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å **–≤—Å–µ** —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```javascript
/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π —Å–Ω–∏—Ñ—Ñ–µ—Ä
 */
(function() {
  const originalFetch = window.fetch;
  const keywords = ['online', 'offline', 'last_seen', 'presence'];

  window.fetch = async function(url, options) {
    const response = await originalFetch.apply(this, arguments);
    
    try {
      const clone = response.clone();
      const text = await clone.text();
      
      // –ò—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
      const found = keywords.filter(kw => text.toLowerCase().includes(kw));
      
      if (found.length > 0) {
        console.log(`%c[MATCH: ${found.join(', ')}]%c ${url}`,
          'background: #4CAF50; color: white; padding: 2px 6px;', '');
        console.log(text.substring(0, 500));
      }
    } catch (e) {}
    
    return response;
  };
  
  console.log('‚úÖ –°–µ—Ç–µ–≤–æ–π —Å–Ω–∏—Ñ—Ñ–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ò—â—É:', keywords.join(', '));
})();
```

–ò —Ç—É—Ç —è –∑–∞–º–µ—Ç–∏–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –≤ –ª–æ–≥–∞—Ö:

```
[WebSocket CREATED] wss://eh.vk.com/?v=1.000&format=json&app_id=6287487
```

**–ü–æ—Ö–æ–∂–µ, –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –ø–µ—Ä–µ–Ω—ë—Å –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å—ã –Ω–∞ WebSocket!**

---

## –®–∞–≥ 5: –ü–µ—Ä–µ—Ö–≤–∞—Ç WebSocket

WebSocket ‚Äî —ç—Ç–æ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª, –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –µ–≥–æ –Ω—É–∂–Ω–æ –∏–Ω–∞—á–µ:

```javascript
/**
 * WebSocket —Å–Ω–∏—Ñ—Ñ–µ—Ä –¥–ª—è VK
 */
(function() {
  const OriginalWebSocket = window.WebSocket;

  window.WebSocket = function(url, protocols) {
    console.log('%c[WS Created]%c ' + url, 
      'background: #9C27B0; color: white; padding: 2px 6px;', '');

    const ws = protocols 
      ? new OriginalWebSocket(url, protocols) 
      : new OriginalWebSocket(url);

    ws.addEventListener('message', async function(event) {
      let data = event.data;
      
      // –î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∫ Blob
      if (data instanceof Blob) {
        const buffer = await data.arrayBuffer();
        const bytes = new Uint8Array(buffer);
        // –ü–µ—Ä–≤—ã–π –±–∞–π—Ç ‚Äî —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî JSON
        const jsonStr = new TextDecoder().decode(bytes.slice(1));
        try {
          data = JSON.parse(jsonStr);
        } catch (e) {
          data = jsonStr;
        }
      }

      console.log('%c[WS Message]%c', 
        'background: #2196F3; color: white; padding: 2px 6px;', '', data);
    });

    return ws;
  };

  // –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
  window.WebSocket.OPEN = OriginalWebSocket.OPEN;
  window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
  window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;
  
  console.log('‚úÖ WebSocket —Å–Ω–∏—Ñ—Ñ–µ—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
})();
```

–î–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `eh.vk.com` –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ú–Ω–µ —É–¥–∞–ª–æ—Å—å —á–∞—Å—Ç–∏—á–Ω–æ –∏—Ö –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–æ–±—Ä–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –∫–∞–∫ Blob, –∏ –ø–æ—Å–ª–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞ (—Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è) –æ—Å—Ç–∞–≤–∞–ª—Å—è JSON, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ã–ª–∞ —Å–ª–æ–∂–Ω–æ–π.

**–í–∞–∂–Ω–æ:** –Ø –Ω–µ –º–æ–≥—É —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –Ω–∞ 100%, —á—Ç–æ –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å—ã –∏–¥—É—Ç –∏–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç WebSocket. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫-—Ç–æ –∏–Ω–∞—á–µ, –∏–ª–∏ VK –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤. –ï—Å–ª–∏ —É –≤–∞—Å –ø–æ–ª—É—á–∏—Ç—Å—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≥–ª—É–±–∂–µ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ, –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ!

–í —Ä–∞–º–∫–∞—Ö —Å–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —è —Ä–µ—à–∏–ª –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–±—Ä–∞–ª —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å–∞.

---

## –ò—Ç–æ–≥–æ–≤—ã–π –º–æ–¥—É–ª—å —Å–ª–µ–∂–∫–∏

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —è –Ω–∞–ø–∏—Å–∞–ª production-ready –º–æ–¥—É–ª—å. –û–Ω –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:

```javascript
/**
 * VKify Spy Module
 * Production-–≤–µ—Ä—Å–∏—è –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
 * 
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 * 1. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ VK
 * 2. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ –∏ –∂–¥–∏—Ç–µ —Å–æ–±—ã—Ç–∏–π
 * 3. –ò–ª–∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è: window.addEventListener('vkify-spy-event', e => console.log(e.detail))
 */
(function() {
  'use strict';

  if (window.__vkifySpyModule) {
    console.log('[VKify Spy] –£–∂–µ –∑–∞–ø—É—â–µ–Ω');
    return;
  }
  window.__vkifySpyModule = true;

  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (—Å–æ–±—Ä–∞–Ω–∞ –≤ —Ö–æ–¥–µ —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞)
  const EVENT_CONFIG = {
    63: { action: '–ø–µ—á–∞—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ', icon: '‚å®Ô∏è', category: 'typing' },
    64: { action: '–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ', icon: 'üé§', category: 'voice' },
    52: { action: '—Å–æ–±—ã—Ç–∏–µ –¥—Ä—É–∑–µ–π', icon: 'üë•', category: 'friends' },
    90: { action: '—Å–æ–±—ã—Ç–∏–µ –¥—Ä—É–∑–µ–π', icon: 'üë•', category: 'friends' },
    115: { action: '–∑–≤–æ–Ω–∏—Ç –≤–∞–º', icon: 'üìû', category: 'calls' },
    10002: { action: '—É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö', icon: 'üóëÔ∏è', category: 'delete' },
    10004: { action: '–æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ', icon: 'üí¨', category: 'messages' },
    10005: { action: '–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ', icon: '‚úèÔ∏è', category: 'edit' },
    10007: { action: '–ø—Ä–æ—á–∏—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ', icon: 'üëÅÔ∏è', category: 'read' }
  };

  let eventCount = 0;

  function parseEvent(update) {
    const code = update[0];
    const config = EVENT_CONFIG[code];
    if (!config) return null;

    let userId = null;
    let extra = {};

    switch (code) {
      case 63: case 64:
        userId = update[1];
        break;
      case 52:
        userId = update[2];
        extra.type = update[1];
        break;
      case 90:
        userId = update[2];
        extra.actionType = update[1];
        break;
      case 115:
        userId = update[1]?.user_id || update[1]?.peer_id;
        break;
      case 10002:
        userId = update[3];
        break;
      case 10004:
        if (update[2] & 2) return null; // –ò—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        userId = update[4];
        extra.text = update[6]?.substring(0, 100);
        break;
      case 10005:
        if (update[2] & 2) return null;
        userId = update[3];
        extra.text = update[5]?.substring(0, 100);
        break;
      case 10007:
        userId = update[1];
        break;
    }

    if (!userId) return null;

    return { code, userId, ...config, extra, timestamp: new Date().toISOString() };
  }

  // –ü–µ—Ä–µ—Ö–≤–∞—Ç Long Poll
  const originalFetch = window.fetch;

  window.fetch = async function(url, options) {
    const response = await originalFetch.apply(this, arguments);

    if (/api\.vk\.com\/ruim/.test(url?.toString() || '')) {
      try {
        const clone = response.clone();
        const data = await clone.json();

        data.updates?.forEach(update => {
          const event = parseEvent(update);
          if (event) {
            eventCount++;
            console.log(
              `%c[VKify Spy]%c ${event.icon} User ${event.userId}: ${event.action}`,
              'background: #5181b8; color: white; padding: 2px 6px; border-radius: 3px;',
              'color: inherit;',
              event.extra
            );
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
            window.dispatchEvent(new CustomEvent('vkify-spy-event', { 
              detail: event 
            }));
          }
        });
      } catch (e) {}
    }

    return response;
  };

  // –ü—É–±–ª–∏—á–Ω–æ–µ API
  window.__vkifySpy = {
    getEventCount: () => eventCount,
    getConfig: () => EVENT_CONFIG,
    status() {
      console.log(`[VKify Spy] –ê–∫—Ç–∏–≤–µ–Ω. –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: ${eventCount}`);
    }
  };

  console.log(`
%cüïµÔ∏è VKify Spy Module –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!%c

%c–ú–æ–¥—É–ª—å –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç:%c
‚Ä¢ –ü–µ—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π (‚å®Ô∏è)
‚Ä¢ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (üé§)
‚Ä¢ –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (üí¨)
‚Ä¢ –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (üëÅÔ∏è)
‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (üóëÔ∏è)
‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (‚úèÔ∏è)
‚Ä¢ –°–æ–±—ã—Ç–∏—è –¥—Ä—É–∑–µ–π (üë•)
‚Ä¢ –ó–≤–æ–Ω–∫–∏ (üìû)

%c–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:%c
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –¥–∏–∞–ª–æ–≥
2. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–∞–º
3. –°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏

%c–ö–æ–º–∞–Ω–¥—ã:%c __vkifySpy.status()
`,
    'color: #5181b8; font-weight: bold; font-size: 14px;', '',
    'color: #4CAF50; font-weight: bold;', '',
    'color: #2196F3; font-weight: bold;', '',
    'background: #151515; padding: 2px 6px; border-radius: 3px;', ''
  );

})();
```
![–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è —Å–ª–µ–∂–∫–∏](img/lGNPO2eQMp.png)

---

## –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ —è —É–∑–Ω–∞–ª

1. **Long Poll –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
2. **–û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å—ã, –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã–Ω–µ—Å–µ–Ω—ã –Ω–∞ WebSocket** (`eh.vk.com`) ‚Äî –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–æ–±—Ä–∞—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π –Ω–µ –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** ‚Äî –Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. **–ö–æ–¥—ã 10000+** ‚Äî —ç—Ç–æ "–Ω–æ–≤—ã–µ" —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π

### –°–æ–≤–µ—Ç—ã –ø–æ —Ä–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥—É

1. **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ** ‚Äî –±–∞–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç fetch –¥–∞—ë—Ç 80% –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
2. **–°–æ–±–∏—Ä–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏–π
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –ø–æ–º–æ—â–Ω–∏–∫–æ–º** ‚Äî –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ WebSocket** ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—Å—ë –±–æ–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–∞—Ö–æ–¥–∫–∏** ‚Äî —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü –≤—ã –∑–∞–±—É–¥–µ—Ç–µ, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç `update[3]`

### –≠—Ç–∏—á–Ω–æ—Å—Ç—å

–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è:
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π
- ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª–µ–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

–ò –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:
- ‚ùå –°–ª–µ–∂–∫–∏ –∑–∞ –ª—é–¥—å–º–∏ –±–µ–∑ –∏—Ö –≤–µ–¥–æ–º–∞
- ‚ùå –°–±–æ—Ä–∞ —á—É–∂–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—è ToS —Å–µ—Ä–≤–∏—Å–æ–≤

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [VK Long Poll Server Documentation](https://dev.vk.com/api/user-long-poll/getting-started) ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–Ω–µ–ø–æ–ª–Ω–∞—è)
- [Chrome DevTools Network Panel](https://developer.chrome.com/docs/devtools/network/) ‚Äî –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- [MDN: Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API) ‚Äî –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
- [MDN: WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) ‚Äî –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WS

---

*–°—Ç–∞—Ç—å—è –Ω–∞–ø–∏—Å–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ [VKify](https://0x69.ru/ru/portfolio/vkify-vkontakte-extension/)*