{{ define "title" }}{{ .Title }}{{ end }}

{{ define "css" }}
{{/* Syntax Highlighting */}}
{{ if site.Params.SyntaxHighlighting }}
<link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/{{ site.Params.SyntaxHighlightingThemeDark }}.min.css" data-syntax-highlight="true" id="syntax-theme">
{{ end }}

{{/* Video Player */}}
{{ if .Page.Store.Get "hasVideoShortcode" }}
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
{{ end }}

{{/* Swiper */}}
{{ if .Page.Store.Get "hasSwiperShortcode" }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
{{ end }}

<style>
  /* Base Styles */
  pre { border-radius: 0.5rem; {{ if not site.Params.SyntaxHighlighting }}padding: 1rem; overflow: auto;{{ end }} }
  
  /* Swiper */
  {{ if .Page.Store.Get "hasSwiperShortcode" }}
  .swiper-slide { position: relative; overflow: hidden; }
  .swiper-slide img { display: block; width: 100%; height: 300px; object-fit: cover; border-radius: 0.625rem; object-position: top; }
  .swiper-pagination { position: absolute; bottom: 0.625rem; left: 50%; width: 90%; height: 0.3rem; background: rgba(255,255,255,0.3); border-radius: 0.2rem; }
  .swiper-pagination-progressbar-fill { background: oklch(var(--p)); border-radius: 0.2rem; }
  @media (max-width: 768px) { .swiper-slide img { height: auto; max-height: 200px; } }
  {{ end }}
  
  /* Reading Progress */
  .reading-progress { position: fixed; top: 0; left: 0; height: 3px; background: oklch(var(--p)); z-index: 9999; transition: width 0.1s ease-out; }
  
  /* Smooth anchor scroll */
  html { scroll-behavior: smooth; scroll-padding-top: 5rem; }
  
  /* Enhanced TOC */
  #TableOfContents { position: sticky; top: 5rem; max-height: calc(100vh - 6rem); overflow-y: auto; }
  #TableOfContents a.active { color: oklch(var(--p)); font-weight: 600; }
  #TableOfContents ul { border-left: 2px solid oklch(var(--b3)); }
  
  /* Image hover effect */
  #dream-single-post-content img { transition: transform 0.3s ease, box-shadow 0.3s ease; }
  #dream-single-post-content img:hover { transform: scale(1.02); box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
  
  /* Link underline animation */
  #dream-single-post-content a:not(.badge):not(.btn):not(.lg-item) { 
    text-decoration: none; 
    background-image: linear-gradient(oklch(var(--p)), oklch(var(--p)));
    background-size: 0% 2px;
    background-position: 0 100%;
    background-repeat: no-repeat;
    transition: background-size 0.3s ease;
  }
  #dream-single-post-content a:not(.badge):not(.btn):not(.lg-item):hover { background-size: 100% 2px; }
  
  /* LightGallery */
  .lg-sub-html { backdrop-filter: blur(16px); }
</style>

{{ partialCached "comments/commentSystemHeads.html" . }}
{{ end }}

{{ define "main" }}
{{/* Reading Progress Bar */}}
<div class="reading-progress" id="reading-progress"></div>

<div class="lg:grid lg:grid-cols-4 gap-6 mt-4 px-4 max-w-screen-2xl mx-auto">
  {{/* Left Sidebar - Desktop Only */}}
  <aside class="hidden lg:block">
    <div class="sticky top-20 space-y-4">
      {{/* Quick Actions */}}
      <div class="flex flex-col gap-2">
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="btn btn-ghost btn-sm gap-2" aria-label="{{ T "backToTop" | default "Back to top" }}">
          <ion-icon name="arrow-up-outline"></ion-icon>
          <span class="text-xs">{{ T "backToTop" | default "Top" }}</span>
        </button>
      </div>
    </div>
  </aside>

  {{/* Main Content */}}
  <article class="lg:col-span-2 mx-auto prose prose-quoteless dark:prose-invert w-full" id="dream-single-post-main" itemscope itemtype="http://schema.org/Article">
    {{ template "_internal/schema.html" . }}

    <header class="not-prose mb-8">
      {{/* Categories */}}
      {{ with .Params.categories }}
      <div class="flex flex-wrap gap-2 mb-4">
        {{ $base := path.Join "categories" | relLangURL | printf "%s/" }}
        {{ range . }}
        <a href="{{ $base }}{{ . | anchorize }}/" class="badge badge-outline badge-sm hover:badge-primary transition-all" rel="category">
          {{ . | strings.FirstUpper }}
        </a>
        {{ end }}
      </div>
      {{ end }}

      {{/* Title */}}
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-4" itemprop="headline">{{ .Title }}</h1>

      {{/* Meta Info */}}
      <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-base-content/70 mb-6">
        {{/* Date */}}
        <time datetime="{{ .Date.Format "2006-01-02" }}" class="flex items-center gap-1">
          <ion-icon name="calendar-outline" class="text-base"></ion-icon>
          {{ if site.Params.Experimental.jsDate }}
          <span data-format="luxon">{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}</span>
          {{ else }}
          {{ .Date | time.Format ":date_long" }}
          {{ end }}
        </time>

        {{/* Reading Time */}}
        <span class="flex items-center gap-1">
          <ion-icon name="time-outline" class="text-base"></ion-icon>
          {{ .ReadingTime }} {{ T "minuteRead" .ReadingTime }}
        </span>

        {{/* Word Count */}}
        <span class="flex items-center gap-1">
          <ion-icon name="document-text-outline" class="text-base"></ion-icon>
          {{ .WordCount }} {{ T "words" | default "words" }}
        </span>

        {{/* Last Modified */}}
        {{ if and (ne .Params.nolastmod true) (ne .Date .Lastmod) }}
        <span class="flex items-center gap-1" title="{{ T "updatedAt" }}">
          <ion-icon name="refresh-outline" class="text-base"></ion-icon>
          {{ if site.Params.Experimental.jsDate }}
          <span data-format="luxon">{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}</span>
          {{ else }}
          {{ .Lastmod | time.Format ":date_medium" }}
          {{ end }}
        </span>
        {{ end }}
      </div>

      {{/* Author & Share */}}
      <div class="flex flex-wrap justify-between items-center gap-4 py-4 border-y border-base-300">
        {{ partial "author.html" (dict "Params" .Params "template" "single") }}
        {{ partial "share.html" . }}
      </div>
    </header>

    {{/* Translation Notice */}}
    {{ if .IsTranslated }}
    <div class="not-prose mb-8">
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 p-4 rounded-xl border border-base-300 bg-base-200/50">
        {{/* Icon with pulse animation */}}
        <div class="flex items-center gap-2 text-base-content/70">
          <span class="relative flex h-3 w-3">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-primary"></span>
          </span>
          <ion-icon name="language-outline" class="text-xl"></ion-icon>
          <span class="text-sm whitespace-nowrap">{{ i18n "post_available_in.text" }}</span>
        </div>
        
        {{/* Divider */}}
        <div class="hidden sm:block w-px h-6 bg-base-300"></div>
        
        {{/* Languages */}}
        <div class="flex flex-wrap gap-2">
          {{ range $index, $translation := .Translations }}
          <a href="{{ $translation.Permalink }}" 
            class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm 
                    bg-base-100 hover:bg-primary hover:text-primary-content 
                    border border-base-300 hover:border-primary
                    transition-all duration-200 no-underline"
            rel="noopener noreferrer"
            hreflang="{{ $translation.Language.Lang }}">
            <span class="opacity-70 group-hover:opacity-100">
              {{ $lang := $translation.Language.Lang }}
              {{- if eq $lang "en" }}üá¨üáß
              {{- else if eq $lang "ru" }}üá∑üá∫
              {{- else if eq $lang "de" }}üá©üá™
              {{- else if eq $lang "fr" }}üá´üá∑
              {{- else if eq $lang "es" }}üá™üá∏
              {{- else if eq $lang "uk" }}üá∫üá¶
              {{- else }}üåê
              {{- end }}
            </span>
            {{ $translation.Language.LanguageName }}
            <ion-icon name="arrow-forward" class="text-xs opacity-0 -ml-1 group-hover:opacity-100 group-hover:ml-0 transition-all"></ion-icon>
          </a>
          {{ end }}
        </div>
      </div>
    </div>
    {{ end }}

    {{/* Cover Image */}}
    {{ if and .Params.Cover site.Params.showSummaryCoverInPost }}
    <figure class="not-prose mb-8">
      <img src="{{ (printf "%s/%s" $.Page.RelPermalink .Params.Cover) | absURL }}" alt="{{ .Title }}" class="w-full rounded-xl shadow-lg" loading="lazy"/>
    </figure>
    {{ end }}

    {{/* Portfolio Tools */}}
    {{ if eq .Section "portfolio" }}
    {{ partial "portfolio/toolsUsed.html" . }}

    {{ if or .Params.github .Params.demo }}
    <div class="not-prose mb-8 z-40">
      <div class="flex flex-wrap items-center justify-between gap-3 p-3 rounded-xl bg-base-100/80 backdrop-blur-md border border-base-300 shadow-lg">
        {{/* Left: Project title */}}
        <div class="flex items-center gap-2 min-w-0">
          <ion-icon name="folder-open-outline" class="text-xl text-primary shrink-0"></ion-icon>
          <span class="font-medium truncate text-sm sm:text-base">{{ .Title }}</span>
        </div>
        
        {{/* Right: Actions */}}
        <div class="flex items-center gap-2">
          {{ with .Params.github }}
          <a href="{{ . }}" 
            target="_blank" 
            rel="noopener noreferrer"
            class="btn btn-sm btn-ghost gap-1.5"
            title="View on GitHub">
            <ion-icon name="logo-github" class="text-lg"></ion-icon>
            <span class="hidden sm:inline">GitHub</span>
          </a>
          {{ end }}
          
          {{ with .Params.demo }}
          <a href="{{ . }}" 
            target="_blank" 
            rel="noopener noreferrer"
            class="btn btn-sm btn-primary gap-1.5"
            title="View Live Demo">
            <ion-icon name="eye-outline" class="text-lg"></ion-icon>
            <span class="hidden sm:inline">Live Demo</span>
          </a>
          {{ end }}
        </div>
      </div>
    </div>
    {{ end }}
    {{ end }}

    

    {{/* Content */}}
    <section id="dream-single-post-content" itemprop="articleBody">
      {{ .Content }}
    </section>

    {{/* Tags */}}
    {{ with .Params.tags }}
    <footer class="not-prose mt-12 pt-6 border-t border-base-300">
      <div class="flex flex-wrap items-center gap-2">
        <ion-icon name="pricetags-outline" class="text-lg text-base-content/60"></ion-icon>
        {{ $base := path.Join "tags" | relLangURL }}
        {{ range . }}
        <a href="{{ $base }}/{{ . | anchorize }}/" class="badge badge-ghost hover:badge-primary transition-colors" rel="tag">
          #{{ . }}
        </a>
        {{ end }}
      </div>
    </footer>
    {{ end }}

    {{/* Navigation */}}
    {{ if site.Params.showPrevNextPost }}
    <nav class="not-prose mt-8" aria-label="Post navigation">
      <div class="divider"></div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {{ with .NextInSection }}
        <a href="{{ .RelPermalink }}" class="group card bg-base-200 hover:bg-base-300 transition-colors p-4">
          <div class="flex items-center gap-3">
            <ion-icon name="chevron-back" class="text-xl text-base-content/50 group-hover:text-primary transition-colors"></ion-icon>
            <div class="min-w-0">
              <span class="text-xs text-base-content/60 uppercase tracking-wide">{{ T "prevPage" }}</span>
              <p class="font-medium truncate">{{ .LinkTitle }}</p>
            </div>
          </div>
        </a>
        {{ else }}<div></div>{{ end }}

        {{ with .PrevInSection }}
        <a href="{{ .RelPermalink }}" class="group card bg-base-200 hover:bg-base-300 transition-colors p-4 md:text-right">
          <div class="flex items-center gap-3 md:flex-row-reverse">
            <ion-icon name="chevron-forward" class="text-xl text-base-content/50 group-hover:text-primary transition-colors"></ion-icon>
            <div class="min-w-0">
              <span class="text-xs text-base-content/60 uppercase tracking-wide">{{ T "nextPage" }}</span>
              <p class="font-medium truncate">{{ .LinkTitle }}</p>
            </div>
          </div>
        </a>
        {{ else }}<div></div>{{ end }}
      </div>
    </nav>
    {{ end }}

    {{/* Comments */}}
    {{ if or site.Config.Services.Disqus.Shortname site.Params.utterancesRepo site.Params.valine site.Params.waline site.Params.commentsApp site.Params.telegramComments }}
    <section class="mt-12">
      {{ partialCached "comments/commentSystems.html" . .RelPermalink }}
    </section>
    {{ end }}
  </article>

  {{/* Right Sidebar */}}
  <aside class="hidden lg:block">
    <div class="sticky top-20 space-y-6">
      {{/* Adsense */}}
      {{ if fileExists "layouts/partials/adsense.html" }}
      <div class="dream-adsense">
        {{ partialCached "adsense.html" . }}
      </div>
      {{ end }}

      {{/* Table of Contents */}}
      {{ if and site.Params.showTableOfContents .TableOfContents }}
      <div class="card bg-base-200 p-4">
        <h3 class="font-semibold mb-3 flex items-center gap-2">
          <ion-icon name="list-outline"></ion-icon>
          {{ T "tableOfContents" | default "Contents" }}
        </h3>
        <nav class="text-sm">
          {{ .TableOfContents }}
        </nav>
      </div>
      {{ end }}
    </div>
  </aside>
</div>

{{/* Mobile FAB - sticky version */}}
<div class="lg:hidden sticky bottom-6 z-50 pointer-events-none">
  <div class="flex justify-end pr-6">
    <button onclick="document.getElementById('mobile-actions-modal').showModal()" 
            class="pointer-events-auto btn btn-circle btn-primary shadow-2xl w-14 h-14 group">
      <ion-icon name="apps" class="text-2xl transition-transform duration-300 group-active:scale-90"></ion-icon>
    </button>
  </div>
</div>

{{/* Mobile Actions Modal */}}
<dialog id="mobile-actions-modal" class="modal modal-bottom lg:hidden">
  <div class="modal-box rounded-t-3xl pb-8">
    {{/* Handle bar */}}
    <div class="flex justify-center mb-4">
      <div class="w-12 h-1.5 bg-base-300 rounded-full"></div>
    </div>
    
    {{/* Header */}}
    <div class="flex items-center justify-between mb-6">
      <h3 class="font-bold text-lg flex items-center gap-2">
        <ion-icon name="apps-outline" class="text-primary"></ion-icon>
        {{ T "quickActions" | default "Quick Actions" }}
      </h3>
      <button onclick="document.getElementById('mobile-actions-modal').close()" 
              class="btn btn-circle btn-ghost btn-sm">
        <ion-icon name="close" class="text-xl"></ion-icon>
      </button>
    </div>
    
    {{/* Actions Grid */}}
    <div class="grid grid-cols-4 gap-3">
      {{/* Back to Top */}}
      <button onclick="window.scrollTo({top: 0, behavior: 'smooth'}); document.getElementById('mobile-actions-modal').close();"
              class="flex flex-col items-center gap-2 p-3 rounded-2xl bg-base-200 active:scale-95 transition-transform">
        <div class="w-12 h-12 rounded-full bg-info/20 flex items-center justify-center">
          <ion-icon name="arrow-up" class="text-2xl text-info"></ion-icon>
        </div>
        <span class="text-xs">{{ T "top" | default "Top" }}</span>
      </button>
      
      {{/* Table of Contents */}}
      {{ if and site.Params.showTableOfContents .TableOfContents }}
      <button onclick="document.getElementById('mobile-actions-modal').close(); setTimeout(() => document.getElementById('mobile-toc-modal').showModal(), 150);"
              class="flex flex-col items-center gap-2 p-3 rounded-2xl bg-base-200 active:scale-95 transition-transform">
        <div class="w-12 h-12 rounded-full bg-success/20 flex items-center justify-center">
          <ion-icon name="list" class="text-2xl text-success"></ion-icon>
        </div>
        <span class="text-xs">{{ T "contents" | default "Contents" }}</span>
      </button>
      {{ end }}
      
      {{/* Share */}}
      <button onclick="navigator.share({title: '{{ .Title }}', url: '{{ .Permalink }}'}).catch(() => {}); document.getElementById('mobile-actions-modal').close();"
              class="flex flex-col items-center gap-2 p-3 rounded-2xl bg-base-200 active:scale-95 transition-transform">
        <div class="w-12 h-12 rounded-full bg-warning/20 flex items-center justify-center">
          <ion-icon name="share-social" class="text-2xl text-warning"></ion-icon>
        </div>
        <span class="text-xs">{{ T "share" | default "Share" }}</span>
      </button>
      
      {{/* Copy Link */}}
      <button onclick="navigator.clipboard.writeText('{{ .Permalink }}'); document.getElementById('mobile-actions-modal').close();"
              class="flex flex-col items-center gap-2 p-3 rounded-2xl bg-base-200 active:scale-95 transition-transform">
        <div class="w-12 h-12 rounded-full bg-error/20 flex items-center justify-center">
          <ion-icon name="copy" class="text-2xl text-error"></ion-icon>
        </div>
        <span class="text-xs">{{ T "copy" | default "Copy" }}</span>
      </button>
    </div>
  </div>
  
  <form method="dialog" class="modal-backdrop bg-black/50">
    <button>close</button>
  </form>
</dialog>

{{/* Mobile TOC Modal */}}
{{ if and site.Params.showTableOfContents .TableOfContents }}
<dialog id="mobile-toc-modal" class="modal modal-bottom">
  <div class="modal-box rounded-t-3xl max-h-[75vh]">
    <div class="flex justify-center mb-4">
      <div class="w-12 h-1.5 bg-base-300 rounded-full"></div>
    </div>
    
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-bold text-lg">{{ T "tableOfContents" | default "Contents" }}</h3>
      <button onclick="document.getElementById('mobile-toc-modal').close()" class="btn btn-circle btn-ghost btn-sm">
        <ion-icon name="close" class="text-xl"></ion-icon>
      </button>
    </div>
    
    <nav class="overflow-y-auto" onclick="if(event.target.tagName === 'A') document.getElementById('mobile-toc-modal').close();">
      {{ .TableOfContents }}
    </nav>
  </div>
  
  <form method="dialog" class="modal-backdrop bg-black/50">
    <button>close</button>
  </form>
</dialog>
{{ end }}
{{ end }}

{{ define "js" }}
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Reading Progress
  const progressBar = document.getElementById('reading-progress');
  const article = document.getElementById('dream-single-post-main');
  
  if (progressBar && article) {
    const updateProgress = () => {
      const rect = article.getBoundingClientRect();
      const scrolled = Math.max(0, -rect.top);
      const total = rect.height - window.innerHeight;
      const progress = Math.min(100, (scrolled / total) * 100);
      progressBar.style.width = `${progress}%`;
    };
    
    window.addEventListener('scroll', updateProgress, { passive: true });
    updateProgress();
  }

  // Active TOC Highlight
  const tocLinks = document.querySelectorAll('#TableOfContents a');
  const headings = document.querySelectorAll('#dream-single-post-content h1, #dream-single-post-content h2, #dream-single-post-content h3');
  
  if (tocLinks.length && headings.length) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          tocLinks.forEach(link => link.classList.remove('active'));
          const activeLink = document.querySelector(`#TableOfContents a[href="#${entry.target.id}"]`);
          activeLink?.classList.add('active');
        }
      });
    }, { rootMargin: '-20% 0% -60% 0%' });
    
    headings.forEach(h => observer.observe(h));
  }
});
</script>

{{/* Video Player */}}
{{ if .Page.Store.Get "hasVideoShortcode" }}
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    Plyr.setup('.plyr-video');
  });
</script>
{{ end }}

{{/* Swiper */}}
{{ if .Page.Store.Get "hasSwiperShortcode" }}
<script>
window.initSwiper = function(config) {
  import('https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs').then((SwiperModule) => {
    const Swiper = SwiperModule.default;
    const swiperOptions = {
      loop: config.loop || false,
      autoplay: config.autoplay ? { delay: parseInt(config.autoplay, 10), disableOnInteraction: false } : undefined,
      pagination: config.pagination ? { el: `.swiper-container.${config.id} .swiper-pagination`, type: 'progressbar' } : undefined,
    };
    new Swiper(`.${config.id}-mySwiper`, swiperOptions);
  }).catch((error) => {
    console.error('Failed to load Swiper:', error);
  });
};
</script>
{{ end }}

{{/* Luxon Date */}}
{{ if site.Params.Experimental.jsDate }}
{{ partial "luxon.html" . }}
{{ end }}

{{/* Syntax Highlighting */}}
{{ if site.Params.SyntaxHighlighting }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
{{- range .Site.Params.SyntaxHighlightingLanguages -}}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/{{ . }}.min.js"></script>
{{- end -}}
<script>
  hljs.highlightAll();
  hljs.addPlugin(new CopyButtonPlugin());

  document.addEventListener('alpine:initialized', () => {
    window.customSyntaxHighlighting = {
      dark: '{{ .Site.Params.SyntaxHighlightingThemeDark }}',
      light: '{{ .Site.Params.SyntaxHighlightingThemeLight }}'
    };

    const updateSyntaxTheme = () => {
      try {
        const isDark = Alpine.store('darkMode').isDark();
        const currentTheme = isDark ? 
          window.customSyntaxHighlighting.dark : 
          window.customSyntaxHighlighting.light;

        let link = document.querySelector('link[data-syntax-highlight]');
        if (link) {
          const currentHref = link.href;
          const updatedHref = currentHref.replace(/styles\/[^/]+\.min\.css/, `styles/${currentTheme}.min.css`);
          link.href = updatedHref;
        }
      } catch (error) {
        console.warn('Error updating syntax theme:', error);
      }
    };

    updateSyntaxTheme();
    Alpine.effect(() => {
      updateSyntaxTheme();
    });
  });
</script>
{{ end }}

{{/* Image Gallery */}}
{{ if site.Params.imageZoomableInPost }}
{{ if fileExists "layouts/partials/medium-zoom.html" }}
{{ partialCached "medium-zoom.html" . }}
{{ else }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-fullscreen.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/fullscreen/lg-fullscreen.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const galleryContainer = document.querySelector("#dream-single-post-content");
    const images = galleryContainer?.querySelectorAll("img");

    if (galleryContainer && images?.length > 0) {
      galleryContainer.querySelectorAll("a.lg-item").forEach(el => el.remove());

      images.forEach(img => {
        if (!img.closest("a")) {
          const wrapper = document.createElement("a");
          wrapper.href = img.src;
          wrapper.classList.add("lg-item", "not-prose");

          const title = img.title ? `<h2 class="text-lg">${img.title}</h2>` : "";
          const alt = img.alt ? `<h1 class="text-2xl">${img.alt}</h1>` : "";
          wrapper.dataset.subHtml = `${alt}${title}`;

          img.parentNode.insertBefore(wrapper, img);
          wrapper.appendChild(img);
        }
      });

      lightGallery(galleryContainer, {
        selector: "a.lg-item",
        plugins: [lgZoom, lgFullscreen],
        speed: 500,
        download: false,
        counter: true,
        mousewheel: true,
        closeOnTap: true,
        subHtmlSelectorRelative: true
      });
    }
  });
</script>
{{ end }}
{{ end }}
{{ end }}