{{ define "title" }}
{{ $title := (strings.FirstUpper .Data.Plural) }}
{{ $translation := i18n (print "all" $title) }}
{{ default $title $translation -}}
{{ end }}

{{ define "main"}}

{{ $termCount := len .Data.Terms }}
{{ $pageCount := len (where site.RegularPages (print ".Params." .Data.Plural) "ne" nil) }}

<div class="mt-8 lg:mt-12 px-4 sm:px-6">
  <div class="max-w-7xl mx-auto">

    <!-- Hero секция -->
    <section class="text-center mb-10 lg:mb-14">
      
      <!-- Иконка -->
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-primary/10 text-primary mb-4">
        {{ if eq .Data.Plural "tags" }}
        <ion-icon name="pricetags-outline" class="text-3xl"></ion-icon>
        {{ else if eq .Data.Plural "categories" }}
        <ion-icon name="folder-outline" class="text-3xl"></ion-icon>
        {{ else }}
        <ion-icon name="list-outline" class="text-3xl"></ion-icon>
        {{ end }}
      </div>
      
      <!-- Заголовок -->
      <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold mb-3">
        {{- $title := i18n (print "all" (strings.FirstUpper .Data.Plural)) }}
        {{- default (strings.FirstUpper .Data.Plural) $title -}}
      </h1>
      
      <!-- Описание -->
      <p class="text-base-content/60 max-w-xl mx-auto mb-6">
        {{ if eq .Data.Plural "tags" }}
          {{ i18n "taxonomy.tagsDescription" | default "Навигация по темам и ключевым словам" }}
        {{ else if eq .Data.Plural "categories" }}
          {{ i18n "taxonomy.categoriesDescription" | default "Просмотр материалов по рубрикам" }}
        {{ else }}
          {{ i18n "taxonomy.defaultDescription" | default "Все доступные разделы" }}
        {{ end }}
      </p>
      
      <!-- Статистика -->
      <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
        
        <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-base-200/50 border border-base-300">
          {{ if eq .Data.Plural "tags" }}
          <ion-icon name="pricetag-outline" class="text-lg text-primary"></ion-icon>
          {{ else }}
          <ion-icon name="folder-outline" class="text-lg text-primary"></ion-icon>
          {{ end }}
          <span class="font-bold">{{ $termCount }}</span>
          <span class="text-sm text-base-content/60">
            {{ if eq .Data.Plural "tags" }}
              {{ i18n "taxonomy.tags" | default "тегов" }}
            {{ else if eq .Data.Plural "categories" }}
              {{ i18n "taxonomy.categories" | default "категорий" }}
            {{ else }}
              {{ .Data.Plural }}
            {{ end }}
          </span>
        </div>
        
        <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-base-200/50 border border-base-300">
          <ion-icon name="document-text-outline" class="text-lg text-secondary"></ion-icon>
          <span class="font-bold">{{ $pageCount }}</span>
          <span class="text-sm text-base-content/60">{{ i18n "taxonomy.posts" | default "записей" }}</span>
        </div>
        
      </div>
    </section>

    <!-- Облако тегов / Список категорий -->
    <section class="mb-10 lg:mb-14">
      <div class="p-4 sm:p-6 rounded-2xl bg-base-200/30 border border-base-300">
        
        <!-- Заголовок секции -->
        <div class="flex items-center gap-2 mb-4">
          <ion-icon name="apps-outline" class="text-base-content/50"></ion-icon>
          <span class="text-sm font-medium text-base-content/50">
            {{ if eq .Data.Plural "tags" }}
              {{ i18n "taxonomy.allTags" | default "Все теги" }}
            {{ else }}
              {{ i18n "taxonomy.allCategories" | default "Все категории" }}
            {{ end }}
          </span>
          <div class="flex-1 h-px bg-base-300"></div>
        </div>
        
        <!-- Теги/Категории -->
        <div class="flex flex-wrap gap-2">
          {{ range .Data.Terms.ByCount }}
          {{ $count := .Count }}
          {{ $opacity := "opacity-100" }}
          
          {{/* Прозрачность для редких тегов */}}
          {{ if le $count 1 }}
            {{ $opacity = "opacity-70" }}
          {{ end }}
          
          <a href="{{ .Page.RelPermalink }}" 
             class="group inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg
                    bg-base-100 border border-base-300
                    hover:border-primary hover:bg-primary hover:text-primary-content
                    transition-all duration-200 no-underline {{ $opacity }}">
            <span class="font-medium text-sm">{{ .Page.LinkTitle }}</span>
            <span class="text-xs px-1.5 py-0.5 rounded-full bg-base-200 group-hover:bg-primary-content/20 transition-colors">
              {{ $count }}
            </span>
          </a>
          {{ end }}
        </div>
        
      </div>
    </section>

    <div class="divider"></div>

    <!-- Контент -->
    <section>
      {{ $paginator := .Paginate (where site.RegularPages (print ".Params." .Data.Plural) "ne" nil) }}

      <!-- Заголовок списка -->
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-lg font-bold flex items-center gap-2">
          <ion-icon name="newspaper-outline" class="text-xl text-primary"></ion-icon>
          {{ i18n "taxonomy.latestPosts" | default "Последние записи" }}
        </h2>
        <span class="text-sm text-base-content/50">
          {{ $paginator.TotalNumberOfElements }} {{ i18n "taxonomy.total" | default "всего" }}
        </span>
      </div>

      {{ if site.Params.zenMode }}
      
      <!-- Zen Mode -->
      <div class="dream-zen-posts max-w-[65ch] mx-auto space-y-6">
        {{ range $paginator.Pages }}
          {{ .Render "zen-summary" }}
        {{ end }}
      </div>
      
      {{ else }}
      
      <!-- Grid Mode -->
      <div class="dream-grid">
        {{ range $paginator.Pages }}
        <div class="w-full sm:w-1/2 lg:w-1/3 p-2 sm:p-3 dream-column">
          {{ .Render "summary" }}
        </div>
        {{ end }}
      </div>
      
      {{ end }}

      <!-- Пагинация -->
      {{ if gt $paginator.TotalPages 1 }}
      <div class="flex justify-center pt-10">
        {{ partial "paginator.html" (dict "paginator" $paginator) }}
      </div>
      {{ end }}
      
    </section>

  </div>
</div>

{{ end }}

{{ define "js" }}
{{ if site.Params.Experimental.jsDate }}
{{ partial "luxon.html" . }}
{{ end }}
{{ end }}