{{/* Навигационные элементы */}}
{{ $navItems := slice "search" "rss" "posts" "categories" "tags" }}
{{ if site.Params.reorderNavItems }}
  {{ $navItems = site.Params.reorderNavItems }}
{{ end }}

<nav class="space-y-4" aria-label="{{ i18n "menu.navigation" | default "Навигация" }}">

  <!-- Переключатель языка -->
  <div class="space-y-2">
    <h3 class="px-3 text-xs font-semibold uppercase tracking-wider text-base-content/50">
      {{ i18n "menu.languages" | default "Язык" }}
    </h3>
    <ul class="space-y-1">
      {{ range $langCode, $lang := $.Site.Params.navLang }}
        {{ $translatedPage := where $.Page.Translations "Lang" $langCode | first 1 }}
        {{ $isCategoriesPage := hasPrefix ($.Path) "/categories/" }}
        {{ $isTagsPage := hasPrefix ($.Path) "/tags/" }}
        {{ $isActive := eq $langCode $.Site.Language.Lang }}
        
        {{/* Определяем правильную ссылку */}}
        {{ $link := "" }}
        {{ if or $isCategoriesPage $isTagsPage }}
          {{ $section := cond $isCategoriesPage "categories" "tags" }}
          {{ $link = printf "%s%s/%s/" $.Site.BaseURL $langCode $section }}
        {{ else if $translatedPage }}
          {{ $link = (index $translatedPage 0).Permalink }}
        {{ else }}
          {{ $currentPath := strings.TrimPrefix (printf "/%s/" $.Site.Language.Lang) $.Page.RelPermalink }}
          {{ $link = printf "%s%s/%s" $.Site.BaseURL $langCode $currentPath }}
        {{ end }}
        
        <li>
          <a href="{{ $link }}" 
             title="{{ $lang.title }}"
             hreflang="{{ $langCode }}"
             class="flex items-center gap-3 px-3 py-2.5 rounded-lg
                    transition-all duration-200
                    {{ if $isActive }}
                      bg-primary/10 text-primary font-medium
                    {{ else }}
                      hover:bg-base-200
                    {{ end }}"
             {{ if $isActive }}aria-current="true"{{ end }}>
            <ion-icon name="{{ $lang.icon }}" class="text-lg"></ion-icon>
            <span class="flex-1">{{ $lang.title }}</span>
            {{ if $isActive }}
            <ion-icon name="checkmark-circle" class="text-primary"></ion-icon>
            {{ end }}
          </a>
        </li>
      {{ end }}
    </ul>
  </div>

  <!-- Разделитель -->
  <div class="border-t border-base-200 dark:border-base-content/10"></div>

  <!-- Меню навигации -->
  <div class="space-y-2">
    <h3 class="px-3 text-xs font-semibold uppercase tracking-wider text-base-content/50">
      {{ i18n "menu.menu" | default "Меню" }}
    </h3>
    <ul class="space-y-1">
      {{ range $navItems }}
        {{ partial "renderMobileNavItem.html" (dict "item" . "site" $.Site) }}
      {{ end }}
      
      {{ with site.Params.navItems }}
        {{ partial "navCustomItems.html" (dict "navItems" $navItems "mobile" true "site" $.Site) }}
      {{ end }}
    </ul>
  </div>

</nav>