{{- $menuItemClass := "flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium cursor-pointer transition-all duration-200 hover:bg-base-200 active:scale-[0.98] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/50" -}}
{{- $menuItemActiveClass := "bg-primary/10 text-primary font-semibold" -}}
{{- $menuIconClass := "text-lg flex-shrink-0" -}}

{{ $navItems := slice "search" "rss" "posts" "utilities" "categories" "tags" }}
{{ if site.Params.reorderNavItems }}
  {{ $navItems = site.Params.reorderNavItems }}
{{ end }}

<nav class="space-y-4" aria-label="{{ i18n "menu.navigation" | default "Навигация" }}">

  <!-- Переключатель языка -->
  <div class="space-y-2">
    <h3 class="px-3 text-xs font-semibold uppercase tracking-wider text-base-content/50">
      {{ i18n "menu.languages" | default "Язык" }}
    </h3>
    <ul class="space-y-1">
      {{ range $langCode, $lang := $.Site.Params.navLang }}
        {{ $isActive := eq $langCode $.Site.Language.Lang }}
        {{ $link := "" }}

        {{/* Ищем перевод текущей страницы */}}
        {{ $translatedPage := false }}
        {{ range $.Page.Translations }}
          {{ if eq .Lang $langCode }}
            {{ $translatedPage = . }}
          {{ end }}
        {{ end }}

        {{ if $translatedPage }}
          {{ $link = $translatedPage.Permalink }}
        {{ else if eq $langCode "ru" }}
          {{ $link = "/" }}
        {{ else }}
          {{ $link = printf "/%s/" $langCode }}
        {{ end }}
        
        <li>
          <a href="{{ $link }}" 
             title="{{ $lang.title }}"
             hreflang="{{ $langCode }}"
             class="{{ $menuItemClass }}
                    {{ if $isActive }}{{ $menuItemActiveClass }}{{ end }}"
             {{ if $isActive }}aria-current="true"{{ end }}>
            <ion-icon name="{{ $lang.icon }}" class="{{ $menuIconClass }}"></ion-icon>
            <span class="flex-1">{{ $lang.title }}</span>
            {{ if $isActive }}
            <ion-icon name="checkmark-circle" class="text-primary"></ion-icon>
            {{ end }}
          </a>
        </li>
      {{ end }}
    </ul>
  </div>

  <!-- Разделитель -->
  <div class="border-t border-base-200 dark:border-base-content/10"></div>

  <!-- Меню навигации -->
  <div class="space-y-2">
    <h3 class="px-3 text-xs font-semibold uppercase tracking-wider text-base-content/50">
      {{ i18n "menu.menu" | default "Меню" }}
    </h3>
    <ul class="space-y-1">
      {{ range $navItems }}
        {{ partial "renderMobileNavItem.html" (dict "item" . "site" $.Site) }}
      {{ end }}
      
      {{ with site.Params.navItems }}
        {{ partial "navCustomItems.html" (dict "navItems" $navItems "mobile" true "site" $.Site) }}
      {{ end }}
    </ul>
  </div>

</nav>