{{- $link := . -}}
<script async src="https://telegram.org/js/telegram-widget.js?22" 
data-telegram-discussion="{{ replace $link "https://t.me/" "" }}" 
data-comments-limit="10" data-colorful="1" data-color="1eb854" data-dark="1"></script>
<script>
document.addEventListener('alpine:initialized', () => {
    const updateTelegramTheme = () => {
        try {
            const isDark = Alpine.store('darkMode').isDark();
            const targetDarkValue = isDark ? "1" : "0";

            document.querySelectorAll(".telegram_comments iframe").forEach((iframe) => {
                const src = iframe.getAttribute("src");
                if (src) {
                    const updatedSrc = src.replace(/([?&]dark=)[^&]*/, `$1${targetDarkValue}`);
                    iframe.setAttribute("src", updatedSrc);
                }
            });
        } catch (error) {
            console.warn('Error updating telegram theme:', error);
        }
    };

    updateTelegramTheme();

    Alpine.effect(updateTelegramTheme);
});
</script>