{{ define "title" }}
{{- .Title -}}
{{ end }}

{{ define "main"}}
<div class="mt-8 lg:mt-12 px-4 sm:px-6">
  
  <!-- Заголовок -->
  <div class="mx-auto prose dark:prose-invert text-center mb-8 lg:mb-12">
    <h1 class="text-2xl sm:text-3xl lg:text-4xl">
      {{ default (T "archives") .Title }}
    </h1>
    {{ with .Content }}
    <p class="text-sm sm:text-base text-base-content/70">{{ . }}</p>
    {{ end }}
    
    <!-- Статистика -->
    <div class="not-prose flex justify-center items-center gap-4 sm:gap-6 mt-4 text-sm text-base-content/60">
      <div class="flex items-center gap-1.5">
        <ion-icon name="document-text-outline" class="text-base"></ion-icon>
        <span>{{ len .Pages }} {{ T "posts" | default "записей" }}</span>
      </div>
      <div class="w-1 h-1 rounded-full bg-base-content/30"></div>
      <div class="flex items-center gap-1.5">
        <ion-icon name="calendar-outline" class="text-base"></ion-icon>
        <span>{{ len (.Pages.GroupByDate "2006") }} {{ T "years" | default "лет" }}</span>
      </div>
    </div>
  </div>

  <!-- Быстрая навигация по годам -->
  {{ $groups := .Pages.GroupByDate (default "2006" .Params.groupLayout) }}
  {{ if gt (len $groups) 3 }}
  <div class="max-w-2xl mx-auto mb-6 sm:mb-8">
    <div class="flex flex-wrap justify-center gap-2">
      {{ range $groups }}
      <a href="#year-{{ .Key }}" 
         class="badge badge-outline hover:badge-primary transition-colors duration-200 no-underline">
        {{ .Key }}
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Таймлайн -->
  <div class="max-w-2xl mx-auto">
    {{ $groupLayout := default "2006" .Params.groupLayout }}
    {{ range $index, $group := .Pages.GroupByDate $groupLayout }}
    
    <div id="year-{{ .Key }}" 
         class="relative pl-6 sm:pl-8 pb-8 lg:pb-12 
                scroll-mt-20
                border-l-2 border-base-300 dark:border-base-content/20
                last:pb-0 last:border-l-transparent">
      
      <!-- Точка на линии -->
      <div class="absolute -left-[9px] sm:-left-[11px] top-0 
                  w-4 h-4 sm:w-5 sm:h-5 
                  rounded-full bg-base-100 
                  border-2 border-primary
                  flex items-center justify-center
                  transition-transform duration-200 hover:scale-110">
        <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-primary"></div>
      </div>
      
      <!-- Год -->
      <div class="flex items-center gap-2 sm:gap-3 mb-4">
        <h2 class="text-xl sm:text-2xl font-bold text-primary">
          {{ .Key }}
        </h2>
        <span class="badge badge-sm sm:badge-md badge-ghost">
          {{ len .Pages }} {{ if eq (len .Pages) 1 }}{{ T "post" | default "запись" }}{{ else }}{{ T "posts" | default "записей" }}{{ end }}
        </span>
      </div>
      
      <!-- Список постов -->
      <div class="space-y-2 sm:space-y-3">
        {{ range .Pages }}
        <article class="group">
          <a href="{{ .RelPermalink }}" 
             class="block p-3 sm:p-4 
                    rounded-lg sm:rounded-xl
                    bg-base-200/50 dark:bg-base-200/10
                    border border-transparent
                    hover:border-primary/30 hover:bg-base-200 dark:hover:bg-base-200/20
                    hover:shadow-sm
                    transition-all duration-200
                    no-underline">
            
            <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4">
              <!-- Дата -->
              <time datetime="{{ .Date.Format "2006-01-02" }}" 
                    class="text-xs sm:text-sm text-base-content/50 font-mono shrink-0 
                           flex items-center gap-1.5">
                <ion-icon name="calendar-clear-outline" class="text-xs sm:hidden"></ion-icon>
                {{ .Date.Format "02 Jan" }}
              </time>
              
              <!-- Заголовок -->
              <h3 class="text-sm sm:text-base font-medium 
                         group-hover:text-primary transition-colors duration-200
                         line-clamp-2 sm:line-clamp-1">
                {{ .Title }}
              </h3>
              
              <!-- Стрелка (на десктопе) -->
              <ion-icon name="arrow-forward" 
                        class="hidden sm:block ml-auto text-base-content/30 
                               group-hover:text-primary group-hover:translate-x-1
                               transition-all duration-200 shrink-0"></ion-icon>
            </div>
            
            <!-- Описание (если есть) -->
            {{ with .Description }}
            <p class="hidden sm:block text-xs text-base-content/50 mt-2 line-clamp-1">
              {{ . }}
            </p>
            {{ end }}
          </a>
          
          <!-- Теги -->
          {{ with .Params.tags }}
          <div class="flex flex-wrap gap-1.5 mt-2 ml-1">
            {{ range first 3 . }}
            {{ $tagURL := printf "/tags/%s/" (. | urlize) }}
            <a href="{{ $tagURL | relLangURL }}" 
               class="badge badge-sm no-underline hover:badge-primary transition-colors duration-200"
               rel="tag" 
               aria-label="{{ . }}"
               data-tag="{{ . | urlize }}">
              {{ . }}
            </a>
            {{ end }}
            {{ if gt (len .) 3 }}
            <span class="badge badge-sm badge-ghost">+{{ sub (len .) 3 }}</span>
            {{ end }}
          </div>
          {{ end }}
        </article>
        {{ end }}
      </div>
    </div>
    
    {{ end }}
  </div>
  
</div>

<script>
  // Плавная прокрутка к году
  document.querySelectorAll('a[href^="#year-"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        history.pushState(null, null, this.getAttribute('href'));
      }
    });
  });
</script>
{{ end }}