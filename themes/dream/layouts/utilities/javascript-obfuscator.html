{{ define "title" }}
{{ default "JavaScript Obfuscator" }}
{{ end }}

{{ define "main" }}

<div class="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-10">

  <!-- Hero -->
  <div class="text-center mb-6 sm:mb-12">
    <div class="inline-flex items-center justify-center w-14 h-14 sm:w-20 sm:h-20 rounded-2xl bg-primary/10 text-primary mb-3 sm:mb-4">
      <span class="text-3xl sm:text-5xl">üõ°Ô∏è</span>
    </div>
    <h1 class="text-xl sm:text-3xl lg:text-4xl font-bold mb-2 sm:mb-3">{{ .Title }}</h1>
    <p class="text-sm sm:text-base text-base-content/60 max-w-2xl mx-auto mb-3 sm:mb-4 px-2">{{ .Description }}</p>
    
    <div class="flex flex-wrap justify-center gap-1.5 sm:gap-2">
      <span class="inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium bg-success/10 text-success border border-success/20">
        <ion-icon name="shield-checkmark-outline"></ion-icon>
        {{ T "jsObfuscator.inBrowser" }}
      </span>
      <span class="inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium bg-warning/10 text-warning border border-warning/20">
        <ion-icon name="eye-off-outline"></ion-icon>
        {{ T "jsObfuscator.codeProtection" }}
      </span>
      <span class="inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-medium bg-primary/10 text-primary border border-primary/20">
        <ion-icon name="code-slash-outline"></ion-icon>
        JavaScript
      </span>
    </div>
  </div>

  <div class="max-w-6xl mx-auto">
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
      
      <!-- Left panel: Code -->
      <div class="lg:col-span-2 space-y-3 sm:space-y-4">
        
        <!-- Input code -->
        <div class="bg-base-100 rounded-xl sm:rounded-2xl border border-base-200 dark:border-base-content/10 shadow-lg sm:shadow-xl overflow-hidden">
          <div class="p-2.5 sm:p-3 bg-base-200/30 border-b border-base-200 dark:border-base-content/10 flex items-center justify-between gap-2">
            <h2 class="font-semibold text-sm sm:text-base flex items-center gap-1.5 sm:gap-2 shrink-0">
              <ion-icon name="code-outline" class="text-primary"></ion-icon>
              <span class="hidden xs:inline">{{ T "jsObfuscator.sourceCode" }}</span>
              <span class="xs:hidden">{{ T "jsObfuscator.sourceCode" }}</span>
            </h2>
            <div class="flex items-center gap-1.5 sm:gap-2">
              <span class="text-[10px] sm:text-xs text-base-content/50 hidden sm:inline" id="input-stats">0 {{ T "jsObfuscator.characters" }}</span>
              <button id="paste-btn" class="btn btn-ghost btn-xs gap-1">
                <ion-icon name="clipboard-outline"></ion-icon>
                <span class="hidden sm:inline">{{ T "jsObfuscator.paste" }}</span>
              </button>
              <button id="clear-btn" class="btn btn-ghost btn-xs text-error">
                <ion-icon name="trash-outline"></ion-icon>
              </button>
            </div>
          </div>
          <div class="p-2.5 sm:p-4">
            <textarea 
              id="code-input" 
              class="textarea textarea-bordered w-full h-40 sm:h-64 font-mono text-xs sm:text-sm leading-relaxed resize-y"
              placeholder="{{ T "jsObfuscator.placeholder" }}"
              spellcheck="false"
              autocomplete="off"
              autocorrect="off"
              autocapitalize="off"
            ></textarea>
            <div class="sm:hidden mt-1.5 text-[10px] text-base-content/50" id="input-stats-mobile">0 {{ T "jsObfuscator.characters" }}</div>
          </div>
        </div>

        <!-- Settings (mobile: collapsible, shown between input and button) -->
        <div class="lg:hidden">
          <div class="collapse collapse-arrow bg-base-100 rounded-xl border border-base-200 dark:border-base-content/10 shadow-lg">
            <input type="checkbox" id="mobile-settings-toggle" />
            <div class="collapse-title py-3 px-3 sm:px-4 min-h-0">
              <h2 class="font-semibold text-sm flex items-center gap-2">
                <ion-icon name="settings-outline" class="text-primary"></ion-icon>
                {{ T "jsObfuscator.settings" }}
              </h2>
            </div>
            <div class="collapse-content px-3 sm:px-4 pb-3" id="mobile-settings-content">
              
              <!-- Protection level -->
              <div class="mb-3">
                <label class="label py-1">
                  <span class="label-text font-medium text-sm">{{ T "jsObfuscator.protectionLevel" }}</span>
                </label>
                <div class="space-y-1.5">
                  <label class="flex items-center gap-2.5 p-2.5 rounded-lg bg-base-200/50 cursor-pointer active:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="level" value="low" class="radio radio-sm radio-primary" />
                    <div class="flex-1 min-w-0">
                      <div class="font-medium text-sm">{{ T "jsObfuscator.light" }}</div>
                      <div class="text-[11px] text-base-content/60 truncate">{{ T "jsObfuscator.lightDesc" }}</div>
                    </div>
                    <span class="badge badge-success badge-xs sm:badge-sm">{{ T "jsObfuscator.fast" }}</span>
                  </label>
                  <label class="flex items-center gap-2.5 p-2.5 rounded-lg bg-base-200/50 cursor-pointer active:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="level" value="medium" class="radio radio-sm radio-primary" checked />
                    <div class="flex-1 min-w-0">
                      <div class="font-medium text-sm">{{ T "jsObfuscator.medium" }}</div>
                      <div class="text-[11px] text-base-content/60 truncate">{{ T "jsObfuscator.mediumDesc" }}</div>
                    </div>
                    <span class="badge badge-warning badge-xs sm:badge-sm">{{ T "jsObfuscator.balanced" }}</span>
                  </label>
                  <label class="flex items-center gap-2.5 p-2.5 rounded-lg bg-base-200/50 cursor-pointer active:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="level" value="high" class="radio radio-sm radio-primary" />
                    <div class="flex-1 min-w-0">
                      <div class="font-medium text-sm">{{ T "jsObfuscator.high" }}</div>
                      <div class="text-[11px] text-base-content/60 truncate">{{ T "jsObfuscator.highDesc" }}</div>
                    </div>
                    <span class="badge badge-error badge-xs sm:badge-sm">{{ T "jsObfuscator.slower" }}</span>
                  </label>
                </div>
              </div>

              <div class="divider my-2"></div>
              
              <!-- Options -->
              <div class="space-y-2.5">
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="text-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.variableRenaming" }}</span>
                  </div>
                  <input type="checkbox" id="opt-rename-mobile" class="toggle toggle-sm toggle-primary" checked />
                </label>
                
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="lock-closed-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.stringEncryption" }}</span>
                  </div>
                  <input type="checkbox" id="opt-strings-mobile" class="toggle toggle-sm toggle-primary" checked />
                </label>
                
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="git-branch-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.controlFlowFlattening" }}</span>
                  </div>
                  <input type="checkbox" id="opt-controlflow-mobile" class="toggle toggle-sm toggle-primary" />
                </label>
                
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="skull-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.deadCodeInjection" }}</span>
                  </div>
                  <input type="checkbox" id="opt-deadcode-mobile" class="toggle toggle-sm toggle-primary" />
                </label>
                
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="bug-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.antiDebugProtection" }}</span>
                  </div>
                  <input type="checkbox" id="opt-antidebug-mobile" class="toggle toggle-sm toggle-primary" />
                </label>
                
                <label class="flex items-center justify-between cursor-pointer py-0.5">
                  <div class="flex items-center gap-2">
                    <ion-icon name="contract-outline" class="text-base text-base-content/70"></ion-icon>
                    <span class="text-sm">{{ T "jsObfuscator.compactOutput" }}</span>
                  </div>
                  <input type="checkbox" id="opt-compact-mobile" class="toggle toggle-sm toggle-primary" checked />
                </label>
              </div>

              <div class="divider my-2"></div>

              <!-- Name format -->
              <div>
                <label class="label py-1">
                  <span class="label-text font-medium text-sm">{{ T "jsObfuscator.variableNameFormat" }}</span>
                </label>
                <select id="name-format-mobile" class="select select-bordered select-sm w-full">
                  <option value="hexadecimal">{{ T "jsObfuscator.hexadecimal" }}</option>
                  <option value="short">{{ T "jsObfuscator.short" }}</option>
                  <option value="underscore">{{ T "jsObfuscator.underscore" }}</option>
                  <option value="mangled">{{ T "jsObfuscator.mangled" }}</option>
                </select>
              </div>
              
            </div>
          </div>
        </div>

        <!-- Obfuscate button -->
        <div class="flex justify-center">
          <button id="obfuscate-btn" class="btn btn-primary btn-md sm:btn-lg gap-2 px-6 sm:px-8 w-full sm:w-auto">
            <ion-icon name="shield-outline" class="text-lg sm:text-xl"></ion-icon>
            {{ T "jsObfuscator.obfuscateCode" }}
          </button>
        </div>

        <!-- Result -->
        <div class="bg-base-100 rounded-xl sm:rounded-2xl border border-base-200 dark:border-base-content/10 shadow-lg sm:shadow-xl overflow-hidden">
          <div class="p-2.5 sm:p-3 bg-base-200/30 border-b border-base-200 dark:border-base-content/10 flex items-center justify-between gap-2">
            <h2 class="font-semibold text-sm sm:text-base flex items-center gap-1.5 sm:gap-2 shrink-0">
              <ion-icon name="lock-closed-outline" class="text-success"></ion-icon>
              <span class="hidden sm:inline">{{ T "jsObfuscator.obfuscatedCode" }}</span>
              <span class="sm:hidden text-sm">{{ T "jsObfuscator.result" }}</span>
            </h2>
            <div class="flex items-center gap-1.5 sm:gap-2">
              <span class="text-[10px] sm:text-xs text-base-content/50 hidden sm:inline" id="output-stats">0 {{ T "jsObfuscator.characters" }}</span>
              <button id="copy-btn" class="btn btn-ghost btn-xs gap-1">
                <ion-icon name="copy-outline"></ion-icon>
                <span class="hidden sm:inline">{{ T "jsObfuscator.copy" }}</span>
              </button>
              <button id="download-btn" class="btn btn-ghost btn-xs gap-1">
                <ion-icon name="download-outline"></ion-icon>
              </button>
            </div>
          </div>
          <div class="p-2.5 sm:p-4">
            <textarea 
              id="code-output" 
              class="textarea textarea-bordered w-full h-36 sm:h-64 font-mono text-[10px] sm:text-xs leading-relaxed bg-base-200/30 resize-y"
              placeholder="{{ T "jsObfuscator.resultPlaceholder" }}"
              readonly
            ></textarea>
            <div class="sm:hidden mt-1.5 text-[10px] text-base-content/50" id="output-stats-mobile">0 {{ T "jsObfuscator.characters" }}</div>
          </div>
          
          <!-- Statistics -->
          <div id="stats-panel" class="hidden p-2.5 sm:p-4 border-t border-base-200 dark:border-base-content/10">
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 text-center">
              <div class="p-1.5 sm:p-2 rounded-lg bg-base-200/50">
                <div class="text-sm sm:text-lg font-bold text-primary" id="stat-original">0</div>
                <div class="text-[10px] sm:text-xs text-base-content/60">{{ T "jsObfuscator.originalSize" }}</div>
              </div>
              <div class="p-1.5 sm:p-2 rounded-lg bg-base-200/50">
                <div class="text-sm sm:text-lg font-bold text-secondary" id="stat-result">0</div>
                <div class="text-[10px] sm:text-xs text-base-content/60">{{ T "jsObfuscator.result" }}</div>
              </div>
              <div class="p-1.5 sm:p-2 rounded-lg bg-base-200/50">
                <div class="text-sm sm:text-lg font-bold" id="stat-ratio">0%</div>
                <div class="text-[10px] sm:text-xs text-base-content/60">{{ T "jsObfuscator.sizeChange" }}</div>
              </div>
              <div class="p-1.5 sm:p-2 rounded-lg bg-base-200/50">
                <div class="text-sm sm:text-lg font-bold text-accent" id="stat-vars">0</div>
                <div class="text-[10px] sm:text-xs text-base-content/60">{{ T "jsObfuscator.variables" }}</div>
              </div>
            </div>
          </div>
        </div>
        
      </div>

      <!-- Right panel: Settings (desktop only) -->
      <div class="hidden lg:block space-y-4">
        
        <!-- Obfuscation settings -->
        <div class="bg-base-100 rounded-2xl border border-base-200 dark:border-base-content/10 shadow-xl overflow-hidden">
          <div class="p-3 bg-base-200/30 border-b border-base-200 dark:border-base-content/10">
            <h2 class="font-semibold flex items-center gap-2">
              <ion-icon name="settings-outline" class="text-primary"></ion-icon>
              {{ T "jsObfuscator.settings" }}
            </h2>
          </div>
          
          <div class="p-4 space-y-4">
            
            <!-- Protection level -->
            <div>
              <label class="label py-1">
                <span class="label-text font-medium">{{ T "jsObfuscator.protectionLevel" }}</span>
              </label>
              <div class="space-y-2">
                <label class="flex items-center gap-3 p-3 rounded-xl bg-base-200/50 cursor-pointer hover:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                  <input type="radio" name="level-desktop" value="low" class="radio radio-sm radio-primary" />
                  <div class="flex-1">
                    <div class="font-medium text-sm">{{ T "jsObfuscator.light" }}</div>
                    <div class="text-xs text-base-content/60">{{ T "jsObfuscator.lightDesc" }}</div>
                  </div>
                  <span class="badge badge-success badge-sm">{{ T "jsObfuscator.fast" }}</span>
                </label>
                <label class="flex items-center gap-3 p-3 rounded-xl bg-base-200/50 cursor-pointer hover:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                  <input type="radio" name="level-desktop" value="medium" class="radio radio-sm radio-primary" checked />
                  <div class="flex-1">
                    <div class="font-medium text-sm">{{ T "jsObfuscator.medium" }}</div>
                    <div class="text-xs text-base-content/60">{{ T "jsObfuscator.mediumDesc" }}</div>
                  </div>
                  <span class="badge badge-warning badge-sm">{{ T "jsObfuscator.balanced" }}</span>
                </label>
                <label class="flex items-center gap-3 p-3 rounded-xl bg-base-200/50 cursor-pointer hover:bg-base-200 transition-colors has-[:checked]:ring-2 has-[:checked]:ring-primary has-[:checked]:bg-primary/10">
                  <input type="radio" name="level-desktop" value="high" class="radio radio-sm radio-primary" />
                  <div class="flex-1">
                    <div class="font-medium text-sm">{{ T "jsObfuscator.high" }}</div>
                    <div class="text-xs text-base-content/60">{{ T "jsObfuscator.highDesc" }}</div>
                  </div>
                  <span class="badge badge-error badge-sm">{{ T "jsObfuscator.slower" }}</span>
                </label>
              </div>
            </div>

            <div class="divider my-2"></div>
            
            <!-- Options -->
            <div class="space-y-3">
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="text-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.variableRenaming" }}</span>
                </div>
                <input type="checkbox" id="opt-rename" class="toggle toggle-sm toggle-primary" checked />
              </label>
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="lock-closed-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.stringEncryption" }}</span>
                </div>
                <input type="checkbox" id="opt-strings" class="toggle toggle-sm toggle-primary" checked />
              </label>
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="git-branch-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.controlFlowFlattening" }}</span>
                </div>
                <input type="checkbox" id="opt-controlflow" class="toggle toggle-sm toggle-primary" />
              </label>
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="skull-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.deadCodeInjection" }}</span>
                </div>
                <input type="checkbox" id="opt-deadcode" class="toggle toggle-sm toggle-primary" />
              </label>
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="bug-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.antiDebugProtection" }}</span>
                </div>
                <input type="checkbox" id="opt-antidebug" class="toggle toggle-sm toggle-primary" />
              </label>
              
              <label class="flex items-center justify-between cursor-pointer">
                <div class="flex items-center gap-2">
                  <ion-icon name="contract-outline" class="text-lg text-base-content/70"></ion-icon>
                  <span class="text-sm">{{ T "jsObfuscator.compactOutput" }}</span>
                </div>
                <input type="checkbox" id="opt-compact" class="toggle toggle-sm toggle-primary" checked />
              </label>
              
            </div>

            <div class="divider my-2"></div>

            <!-- Name format -->
            <div>
              <label class="label py-1">
                <span class="label-text font-medium text-sm">{{ T "jsObfuscator.variableNameFormat" }}</span>
              </label>
              <select id="name-format" class="select select-bordered select-sm w-full">
                <option value="hexadecimal">{{ T "jsObfuscator.hexadecimal" }}</option>
                <option value="short">{{ T "jsObfuscator.short" }}</option>
                <option value="underscore">{{ T "jsObfuscator.underscore" }}</option>
                <option value="mangled">{{ T "jsObfuscator.mangled" }}</option>
              </select>
            </div>
            
          </div>
        </div>

        <!-- Warning -->
        <div class="alert alert-warning">
          <ion-icon name="warning-outline" class="text-xl"></ion-icon>
          <div class="text-sm">
            <div class="font-semibold">{{ T "jsObfuscator.important" }}</div>
            <p>{{ T "jsObfuscator.warningText" }}</p>
          </div>
        </div>
        
      </div>
      
    </div>

    <!-- Warning mobile -->
    <div class="lg:hidden mt-4">
      <div class="alert alert-warning text-xs sm:text-sm py-2.5 px-3">
        <ion-icon name="warning-outline" class="text-lg"></ion-icon>
        <div>
          <div class="font-semibold">{{ T "jsObfuscator.important" }}</div>
          <p>{{ T "jsObfuscator.warningText" }}</p>
        </div>
      </div>
    </div>

    <!-- Examples and information -->
    <div class="mt-6 sm:mt-8 grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
      
      <div class="p-3 sm:p-4 rounded-xl sm:rounded-2xl bg-base-100 border border-base-200 dark:border-base-content/10">
        <div class="flex sm:block items-center gap-3 sm:gap-0">
          <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl bg-primary/10 flex items-center justify-center shrink-0 sm:mb-3">
            <ion-icon name="text-outline" class="text-xl sm:text-2xl text-primary"></ion-icon>
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-sm sm:text-base mb-0.5 sm:mb-1">{{ T "jsObfuscator.renaming" }}</h3>
            <p class="text-xs sm:text-sm text-base-content/60 mb-1.5 sm:mb-2">{{ T "jsObfuscator.renamingDesc" }}</p>
            <div class="text-[10px] sm:text-xs font-mono bg-base-200 p-1.5 sm:p-2 rounded">
              userName ‚Üí _0x4f2a
            </div>
          </div>
        </div>
      </div>
      
      <div class="p-3 sm:p-4 rounded-xl sm:rounded-2xl bg-base-100 border border-base-200 dark:border-base-content/10">
        <div class="flex sm:block items-center gap-3 sm:gap-0">
          <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl bg-secondary/10 flex items-center justify-center shrink-0 sm:mb-3">
            <ion-icon name="lock-closed-outline" class="text-xl sm:text-2xl text-secondary"></ion-icon>
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-sm sm:text-base mb-0.5 sm:mb-1">{{ T "jsObfuscator.stringEncryptionTitle" }}</h3>
            <p class="text-xs sm:text-sm text-base-content/60 mb-1.5 sm:mb-2">{{ T "jsObfuscator.stringEncryptionDesc" }}</p>
            <div class="text-[10px] sm:text-xs font-mono bg-base-200 p-1.5 sm:p-2 rounded truncate">
              "Hello" ‚Üí _0x3f['decode']()
            </div>
          </div>
        </div>
      </div>
      
      <div class="p-3 sm:p-4 rounded-xl sm:rounded-2xl bg-base-100 border border-base-200 dark:border-base-content/10">
        <div class="flex sm:block items-center gap-3 sm:gap-0">
          <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg sm:rounded-xl bg-accent/10 flex items-center justify-center shrink-0 sm:mb-3">
            <ion-icon name="git-branch-outline" class="text-xl sm:text-2xl text-accent"></ion-icon>
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-sm sm:text-base mb-0.5 sm:mb-1">{{ T "jsObfuscator.controlFlow" }}</h3>
            <p class="text-xs sm:text-sm text-base-content/60 mb-1.5 sm:mb-2">{{ T "jsObfuscator.controlFlowDesc" }}</p>
            <div class="text-[10px] sm:text-xs font-mono bg-base-200 p-1.5 sm:p-2 rounded">
              if/else ‚Üí switch(_0x[...])
            </div>
          </div>
        </div>
      </div>
      
    </div>

  </div>

</div>

<script>
(function() {
  'use strict';

  var i18n = {
    characters: {{ T "jsObfuscator.characters" | jsonify }},
    copied: {{ T "jsObfuscator.copied" | jsonify }},
    copy: {{ T "jsObfuscator.copy" | jsonify }},
    enterCode: {{ T "jsObfuscator.enterCode" | jsonify }},
    error: {{ T "jsObfuscator.error" | jsonify }}
  };

  var codeInput = document.getElementById('code-input');
  var codeOutput = document.getElementById('code-output');
  var obfuscateBtn = document.getElementById('obfuscate-btn');
  var statsPanel = document.getElementById('stats-panel');

  var obfuscatedVarsCount = 0;

  // ========== SYNC MOBILE ‚Üî DESKTOP SETTINGS ==========

  var isMobile = function() {
    return window.innerWidth < 1024;
  };

  // –ü–∞—Ä—ã: desktop ID ‚Üí mobile ID
  var settingPairs = [
    ['opt-rename', 'opt-rename-mobile'],
    ['opt-strings', 'opt-strings-mobile'],
    ['opt-controlflow', 'opt-controlflow-mobile'],
    ['opt-deadcode', 'opt-deadcode-mobile'],
    ['opt-antidebug', 'opt-antidebug-mobile'],
    ['opt-compact', 'opt-compact-mobile']
  ];

  function syncSettings(fromMobile) {
    settingPairs.forEach(function(pair) {
      var desktop = document.getElementById(pair[0]);
      var mobile = document.getElementById(pair[1]);
      if (!desktop || !mobile) return;
      if (fromMobile) {
        desktop.checked = mobile.checked;
      } else {
        mobile.checked = desktop.checked;
      }
    });

    // Name format
    var nfDesktop = document.getElementById('name-format');
    var nfMobile = document.getElementById('name-format-mobile');
    if (nfDesktop && nfMobile) {
      if (fromMobile) {
        nfDesktop.value = nfMobile.value;
      } else {
        nfMobile.value = nfDesktop.value;
      }
    }

    // Level radios
    var levelDesktop = document.querySelector('input[name="level-desktop"]:checked');
    var levelMobile = document.querySelector('input[name="level"]:checked');
    if (fromMobile && levelMobile) {
      var dMatch = document.querySelector('input[name="level-desktop"][value="' + levelMobile.value + '"]');
      if (dMatch) dMatch.checked = true;
    } else if (!fromMobile && levelDesktop) {
      var mMatch = document.querySelector('input[name="level"][value="' + levelDesktop.value + '"]');
      if (mMatch) mMatch.checked = true;
    }
  }

  // Attach sync listeners to mobile controls
  settingPairs.forEach(function(pair) {
    var mobile = document.getElementById(pair[1]);
    var desktop = document.getElementById(pair[0]);
    if (mobile) mobile.addEventListener('change', function() { syncSettings(true); });
    if (desktop) desktop.addEventListener('change', function() { syncSettings(false); });
  });

  var nfMobile = document.getElementById('name-format-mobile');
  var nfDesktop = document.getElementById('name-format');
  if (nfMobile) nfMobile.addEventListener('change', function() { syncSettings(true); });
  if (nfDesktop) nfDesktop.addEventListener('change', function() { syncSettings(false); });

  document.querySelectorAll('input[name="level"]').forEach(function(r) {
    r.addEventListener('change', function() { syncSettings(true); applyLevel(); });
  });
  document.querySelectorAll('input[name="level-desktop"]').forEach(function(r) {
    r.addEventListener('change', function() { syncSettings(false); applyLevel(); });
  });

  // ========== –¢–û–ö–ï–ù–ò–ó–ê–¢–û–† ==========

  function tokenize(code) {
    var tokens = [];
    var i = 0;
    var len = code.length;

    while (i < len) {
      if (code[i] === '/' && i + 1 < len && code[i + 1] === '/') {
        var end = code.indexOf('\n', i);
        if (end === -1) end = len;
        tokens.push({ type: 'comment', value: code.slice(i, end) });
        i = end;
        continue;
      }

      if (code[i] === '/' && i + 1 < len && code[i + 1] === '*') {
        var end = code.indexOf('*/', i + 2);
        if (end === -1) end = len; else end += 2;
        tokens.push({ type: 'comment', value: code.slice(i, end) });
        i = end;
        continue;
      }

      if (code[i] === '"' || code[i] === "'") {
        var quote = code[i];
        var j = i + 1;
        while (j < len) {
          if (code[j] === '\\') { j += 2; continue; }
          if (code[j] === quote) { j++; break; }
          j++;
        }
        tokens.push({ type: 'string', value: code.slice(i, j) });
        i = j;
        continue;
      }

      if (code[i] === '`') {
        var j = i + 1;
        while (j < len) {
          if (code[j] === '\\') { j += 2; continue; }
          if (code[j] === '`') { j++; break; }
          j++;
        }
        tokens.push({ type: 'template', value: code.slice(i, j) });
        i = j;
        continue;
      }

      if (i + 2 < len) {
        var three = code.substr(i, 3);
        if (three === '===' || three === '!==' || three === '>>>' ||
            three === '**=' || three === '>>=' || three === '<<=' ||
            three === '&&=' || three === '||=' || three === '??=' ||
            three === '...') {
          tokens.push({ type: 'punct', value: three });
          i += 3;
          continue;
        }
      }
      if (i + 1 < len) {
        var two = code.substr(i, 2);
        if (two === '++' || two === '--' || two === '+=' || two === '-=' ||
            two === '*=' || two === '/=' || two === '%=' || two === '==' ||
            two === '!=' || two === '<=' || two === '>=' || two === '&&' ||
            two === '||' || two === '??' || two === '=>' || two === '**' ||
            two === '<<' || two === '>>' || two === '&=' || two === '|=' ||
            two === '^=') {
          tokens.push({ type: 'punct', value: two });
          i += 2;
          continue;
        }
      }

      if (/[a-zA-Z_$]/.test(code[i])) {
        var j = i;
        while (j < len && /[a-zA-Z0-9_$]/.test(code[j])) j++;
        tokens.push({ type: 'ident', value: code.slice(i, j) });
        i = j;
        continue;
      }

      if (/[0-9]/.test(code[i])) {
        var j = i;
        if (code[i] === '0' && j + 1 < len && /[xXbBoO]/.test(code[j + 1])) {
          j += 2;
          while (j < len && /[0-9a-fA-F]/.test(code[j])) j++;
        } else {
          while (j < len && /[0-9]/.test(code[j])) j++;
          if (j < len && code[j] === '.') {
            j++;
            while (j < len && /[0-9]/.test(code[j])) j++;
          }
          if (j < len && /[eE]/.test(code[j])) {
            j++;
            if (j < len && /[+-]/.test(code[j])) j++;
            while (j < len && /[0-9]/.test(code[j])) j++;
          }
        }
        tokens.push({ type: 'number', value: code.slice(i, j) });
        i = j;
        continue;
      }

      if (/\s/.test(code[i])) {
        var j = i;
        while (j < len && /\s/.test(code[j])) j++;
        tokens.push({ type: 'whitespace', value: code.slice(i, j) });
        i = j;
        continue;
      }

      if (code[i] === '.') {
        tokens.push({ type: 'dot', value: '.' });
        i++;
        continue;
      }

      tokens.push({ type: 'punct', value: code[i] });
      i++;
    }

    return tokens;
  }

  // ========== –ì–ï–ù–ï–†–ê–¢–û–†–´ –ò–ú–Å–ù ==========

  function createNameGenerator(format) {
    var counter = 0;
    var used = {};
    return function() {
      var name;
      do {
        switch (format) {
          case 'short':
            var chars = 'abcdefghijklmnopqrstuvwxyz';
            var n = '';
            var idx = counter;
            do {
              n = chars[idx % 26] + n;
              idx = Math.floor(idx / 26) - 1;
            } while (idx >= 0);
            name = n;
            break;
          case 'underscore':
            name = '__' + String.fromCharCode(97 + (counter % 26)) + '_' + Math.floor(counter / 26);
            break;
          case 'mangled':
            name = '_$' + counter.toString(36);
            break;
          default:
            name = '_0x' + (0x1000 + counter).toString(16);
        }
        counter++;
      } while (used[name]);
      used[name] = true;
      return name;
    };
  }

  // ========== RESERVED ==========

  var RESERVED = {};
  [
    'break','case','catch','continue','debugger','default','delete',
    'do','else','finally','for','function','if','in','instanceof',
    'new','return','switch','this','throw','try','typeof','var',
    'void','while','with','class','const','enum','export','extends',
    'import','super','implements','interface','let','package','private',
    'protected','public','static','yield','async','await','of','from',
    'as','get','set',
    'true','false','null','undefined','NaN','Infinity',
    'console','window','document','globalThis','self',
    'Array','Object','String','Number','Boolean','Symbol','BigInt',
    'Math','Date','JSON','Promise','Error','TypeError','RangeError',
    'SyntaxError','ReferenceError','RegExp','Map','Set','WeakMap',
    'WeakSet','Proxy','Reflect','Int8Array','Uint8Array','ArrayBuffer',
    'DataView','Float32Array','Float64Array',
    'parseInt','parseFloat','isNaN','isFinite','eval',
    'encodeURI','decodeURI','encodeURIComponent','decodeURIComponent',
    'setTimeout','setInterval','clearTimeout','clearInterval',
    'requestAnimationFrame','cancelAnimationFrame',
    'alert','confirm','prompt','fetch','XMLHttpRequest',
    'arguments','require','module','exports','__dirname','__filename',
    'process','Buffer','global',
    'Event','Element','Node','HTMLElement','addEventListener',
    'removeEventListener','querySelector','querySelectorAll',
    'getElementById','createElement','getAttribute','setAttribute',
    'innerHTML','textContent','classList','style','parentNode',
    'children','appendChild','removeChild','insertBefore',
    'prototype','constructor','__proto__',
    'length','name','message','stack','toString','valueOf',
    'hasOwnProperty','propertyIsEnumerable','isPrototypeOf',
    'then','catch','finally','resolve','reject',
    'push','pop','shift','unshift','splice','slice','concat',
    'map','filter','reduce','forEach','find','findIndex',
    'some','every','includes','indexOf','join','sort','reverse',
    'keys','values','entries','assign','freeze','defineProperty',
    'call','apply','bind',
    'log','warn','error','info','debug','table','dir',
    'atob','btoa','performance','now','clear',
    'outerWidth','outerHeight','innerWidth','innerHeight',
    'charCodeAt','fromCharCode',
    'split','replace','match','search','trim','startsWith','endsWith',
    'substring','substr','toLowerCase','toUpperCase','repeat','padStart','padEnd',
    'stringify','parse',
    'abs','ceil','floor','round','min','max','random','pow','sqrt','sign',
    'PI','E','LOG2E','LOG10E','LN2','LN10',
    'getTime','getFullYear','getMonth','getDate','getHours','getMinutes',
    'getSeconds','toISOString','toLocaleDateString','toLocaleString',
    'create','getPrototypeOf','setPrototypeOf','getOwnPropertyNames',
    'getOwnPropertyDescriptor','defineProperties','preventExtensions',
    'isExtensible','isFrozen','seal','isSealed',
    'all','race','allSettled','any',
    'isArray',
    'is','ownKeys','has','deleteProperty','construct',
    'next','done','value','return','throw',
    'toFixed','toPrecision','toExponential',
    'test','exec','source','flags','ignoreCase','multiline',
    'add','delete','size','forEach',
    'head','body','title','forms','links','images','scripts',
    'location','href','origin','pathname','hash','host','hostname',
    'port','protocol','reload',
    'history','back','forward','go','pushState','replaceState',
    'navigator','userAgent','language','platform','cookieEnabled',
    'localStorage','sessionStorage','getItem','setItem','removeItem',
    'cookie',
    'open','close','write','writeln','readyState',
    'status','statusText','response','responseText','responseType',
    'send','abort','setRequestHeader','getResponseHeader',
    'headers','method','url','mode','credentials','cache',
    'type','target','currentTarget','preventDefault','stopPropagation',
    'bubbles','cancelable','detail','key','code','keyCode',
    'clientX','clientY','pageX','pageY','offsetX','offsetY',
    'screenX','screenY','button','buttons','which',
    'scrollTop','scrollLeft','scrollWidth','scrollHeight',
    'clientWidth','clientHeight','offsetWidth','offsetHeight',
    'getBoundingClientRect','top','left','right','bottom','width','height',
    'className','id','tagName','nodeName','nodeType','nodeValue',
    'firstChild','lastChild','nextSibling','previousSibling',
    'firstElementChild','lastElementChild','nextElementSibling','previousElementSibling',
    'childNodes','parentElement','closest','matches',
    'cloneNode','contains','compareDocumentPosition','normalize',
    'focus','blur','click','submit','reset',
    'checked','disabled','selected','readonly','required',
    'placeholder','autofocus','maxLength','minLength','pattern',
    'step',
    'src','alt','crossOrigin','loading',
    'play','pause','volume','muted','currentTime','duration',
    'paused','ended','loop','autoplay','controls',
    'getContext','canvas','fillRect','clearRect','strokeRect',
    'fillStyle','strokeStyle','lineWidth',
    'beginPath','closePath','moveTo','lineTo','arc',
    'fill','stroke','fillText','strokeText','measureText','font','textAlign',
    'drawImage','save','restore','translate','rotate','scale','transform',
    'animate','cancel','finish','playState',
    'observe','unobserve','disconnect',
    'postMessage','onmessage','onerror','onopen','onclose',
    'Worker','Blob','File','FileReader','FileList',
    'FormData','URLSearchParams','URL','createObjectURL','revokeObjectURL',
    'TextEncoder','TextDecoder','encode','decode',
    'crypto','subtle','getRandomValues','digest','encrypt','decrypt',
    'generateKey','importKey','exportKey',
    'AbortController','AbortSignal','signal',
    'iterator','asyncIterator','hasInstance','species',
    'toPrimitive','toStringTag','description',
    'WeakRef','FinalizationRegistry','deref','register','unregister',
    'at','flat','flatMap','copyWithin',
    'findLast','findLastIndex',
    'structuredClone','queueMicrotask',
    'Intl','DateTimeFormat','NumberFormat',
    'format','resolvedOptions','compare',
    'AggregateError','errors',
    'SharedArrayBuffer','Atomics',
    'toJSON','toLocaleString'
  ].forEach(function(w) { RESERVED[w] = true; });

  // ========== POSITION HELPERS ==========

  function getPrevSignificant(tokens, i) {
    for (var j = i - 1; j >= 0; j--) {
      if (tokens[j].type !== 'whitespace' && tokens[j].type !== 'comment') {
        return { token: tokens[j], index: j };
      }
    }
    return null;
  }

  function getNextSignificant(tokens, i) {
    for (var j = i + 1; j < tokens.length; j++) {
      if (tokens[j].type !== 'whitespace' && tokens[j].type !== 'comment') {
        return { token: tokens[j], index: j };
      }
    }
    return null;
  }

  function isInsideClassBody(tokens, pos) {
    var braceDepth = 0;
    for (var j = pos - 1; j >= 0; j--) {
      var t = tokens[j];
      if (t.type === 'whitespace' || t.type === 'comment') continue;
      if (t.value === '}') braceDepth++;
      if (t.value === '{') {
        if (braceDepth === 0) {
          var before = getPrevSignificant(tokens, j);
          if (before) {
            if (before.token.value === 'class') return true;
            if (before.token.type === 'ident') {
              var bb = getPrevSignificant(tokens, before.index);
              if (bb && bb.token.value === 'class') return true;
              // extends
              if (bb && bb.token.type === 'ident') {
                var bbb = getPrevSignificant(tokens, bb.index);
                if (bbb && bbb.token.value === 'extends') {
                  // class Name extends Other {
                  var bbbb = getPrevSignificant(tokens, bbb.index);
                  if (bbbb && bbbb.token.type === 'ident') {
                    var bbbbb = getPrevSignificant(tokens, bbbb.index);
                    if (bbbbb && bbbbb.token.value === 'class') return true;
                  }
                }
              }
            }
          }
          return false;
        }
        braceDepth--;
      }
    }
    return false;
  }

  function isPropertyPosition(tokens, i) {
    var prev = getPrevSignificant(tokens, i);
    var next = getNextSignificant(tokens, i);

    // After dot
    if (prev && prev.token.type === 'dot') return true;

    // Object key: { key: ... } or { key, ...}
    if (next && next.token.value === ':') {
      if (prev) {
        var pv = prev.token.value;
        if (pv === '{' || pv === ',') return true;
      }
    }

    // Class method: ident( inside class body
    if (next && next.token.value === '(') {
      if (prev) {
        if (prev.token.value === 'function') return false;
        if (prev.token.type === 'ident' &&
            (prev.token.value === 'async' || prev.token.value === 'static' ||
             prev.token.value === 'get' || prev.token.value === 'set')) {
          return true;
        }
        if (prev.token.value === '{' || prev.token.value === '}' || prev.token.value === ';') {
          if (isInsideClassBody(tokens, i)) return true;
        }
      }
    }

    return false;
  }

  // ========== RENAMING ==========

  function findUserDeclarations(tokens) {
    var declarations = {};
    var declKw = { 'var': 1, 'let': 1, 'const': 1 };

    for (var i = 0; i < tokens.length; i++) {
      var tok = tokens[i];
      if (tok.type !== 'ident') continue;
      if (RESERVED[tok.value]) continue;

      var prev = getPrevSignificant(tokens, i);
      if (!prev) continue;

      if (prev.token.type === 'ident' && declKw[prev.token.value]) {
        declarations[tok.value] = true;
        continue;
      }
      if (prev.token.value === 'function') {
        declarations[tok.value] = true;
        continue;
      }
      if (prev.token.value === 'class') {
        declarations[tok.value] = true;
        continue;
      }
    }
    return declarations;
  }

  function renameIdentifiers(tokens, format) {
    var userDecls = findUserDeclarations(tokens);
    var gen = createNameGenerator(format);
    var nameMap = {};
    var count = 0;

    for (var id in userDecls) {
      if (userDecls.hasOwnProperty(id)) {
        nameMap[id] = gen();
        count++;
      }
    }
    obfuscatedVarsCount = count;

    var result = [];
    for (var i = 0; i < tokens.length; i++) {
      var tok = tokens[i];
      if (tok.type === 'ident' && nameMap[tok.value]) {
        if (isPropertyPosition(tokens, i)) {
          result.push(tok);
        } else {
          result.push({ type: 'ident', value: nameMap[tok.value] });
        }
      } else {
        result.push(tok);
      }
    }
    return result;
  }

  // ========== RC4 ==========

  function rc4(key, str) {
    var s = [], j = 0, i, tmp;
    for (i = 0; i < 256; i++) s[i] = i;
    for (i = 0; i < 256; i++) {
      j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;
      tmp = s[i]; s[i] = s[j]; s[j] = tmp;
    }
    var result = '', x = 0;
    j = 0;
    for (i = 0; i < str.length; i++) {
      x = (x + 1) % 256;
      j = (j + s[x]) % 256;
      tmp = s[x]; s[x] = s[j]; s[j] = tmp;
      result += String.fromCharCode(str.charCodeAt(i) ^ s[(s[x] + s[j]) % 256]);
    }
    return result;
  }

  function toHexEscape(str) {
    var r = '';
    for (var i = 0; i < str.length; i++) {
      r += '\\x' + ('0' + str.charCodeAt(i).toString(16)).slice(-2);
    }
    return r;
  }

  // ========== STRING ENCRYPTION ==========

  function obfuscateStrings(tokens) {
    var key = '_k' + Math.random().toString(36).substr(2, 6);
    var arrayName = '_0x' + Math.random().toString(16).substr(2, 4);
    var decoderName = '_0x' + Math.random().toString(16).substr(2, 4);
    var strings = [];

    var resultTokens = [];
    for (var i = 0; i < tokens.length; i++) {
      var tok = tokens[i];
      if (tok.type !== 'string') {
        resultTokens.push(tok);
        continue;
      }

      var raw = tok.value;
      var inner = raw.slice(1, -1);
      if (inner.length === 0) {
        resultTokens.push(tok);
        continue;
      }

      var decoded;
      try {
        decoded = (new Function('return ' + raw))();
      } catch (e) {
        resultTokens.push(tok);
        continue;
      }

      var encrypted = rc4(key, decoded);
      var index = strings.length;
      strings.push(toHexEscape(encrypted));
      resultTokens.push({ type: 'code', value: decoderName + '(' + index + ')' });
    }

    if (strings.length === 0) return { prefix: '', tokens: tokens };

    var keyEscaped = toHexEscape(key);
    var decoder = 'var ' + arrayName + '=[' +
      strings.map(function(s) { return '"' + s + '"'; }).join(',') + '];' +
      'function ' + decoderName + '(i){' +
        'var k="' + keyEscaped + '",s=' + arrayName + '[i],r=[],S=[];' +
        'var j=0,x,c,t;' +
        'for(x=0;x<256;x++)S[x]=x;' +
        'for(x=0;x<256;x++){j=(j+S[x]+k.charCodeAt(x%k.length))%256;t=S[x];S[x]=S[j];S[j]=t;}' +
        'x=0;j=0;' +
        'for(c=0;c<s.length;c++){x=(x+1)%256;j=(j+S[x])%256;t=S[x];S[x]=S[j];S[j]=t;' +
        'r.push(String.fromCharCode(s.charCodeAt(c)^S[(S[x]+S[j])%256]));}' +
        'return r.join("");}';

    return { prefix: decoder, tokens: resultTokens };
  }

  // ========== TOP-LEVEL SPLIT ==========

  function splitTopLevelStatements(code) {
    var statements = [];
    var toks = tokenize(code);
    var depth = 0, parenD = 0, bracketD = 0;
    var current = '';

    for (var i = 0; i < toks.length; i++) {
      var tok = toks[i];
      var val = tok.value;

      if (tok.type !== 'string' && tok.type !== 'template' && tok.type !== 'comment') {
        if (val === '{') depth++;
        else if (val === '}') depth--;
        else if (val === '(') parenD++;
        else if (val === ')') parenD--;
        else if (val === '[') bracketD++;
        else if (val === ']') bracketD--;
      }

      current += val;

      if (depth === 0 && parenD === 0 && bracketD === 0) {
        if (val === ';' || val === '}') {
          var trimmed = current.trim();
          if (trimmed) statements.push(trimmed);
          current = '';
        }
      }
    }

    var remaining = current.trim();
    if (remaining) statements.push(remaining);
    return statements;
  }

  // ========== CONTROL FLOW ==========

  function flattenControlFlow(code) {
    var statements = splitTopLevelStatements(code);
    if (statements.length < 2) return '(function(){' + code + '})();';

    var sv = '_0xcf' + Math.random().toString(16).substr(2, 2);
    var endState = statements.length;
    var indices = [];
    for (var i = 0; i < statements.length; i++) indices.push(i);

    for (var i = indices.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var tmp = indices[i]; indices[i] = indices[j]; indices[j] = tmp;
    }

    var posOf = [];
    for (var i = 0; i < indices.length; i++) posOf[indices[i]] = i;

    var cases = '';
    for (var i = 0; i < indices.length; i++) {
      var origIdx = indices[i];
      var nextState = (origIdx < statements.length - 1) ? posOf[origIdx + 1] : endState;
      cases += 'case ' + i + ':' + statements[origIdx] + ';' + sv + '=' + nextState + ';break;';
    }

    return '(function(){var ' + sv + '=' + posOf[0] + ';while(' + sv + '!==' + endState + '){switch(' + sv + '){' + cases + '}}})();';
  }

  // ========== DEAD CODE ==========

  function injectDeadCode(code) {
    var statements = splitTopLevelStatements(code);
    function gv() { return '_0x' + Math.random().toString(16).substr(2, 4); }
    function ms() {
      var t = Math.floor(Math.random() * 5), v = gv();
      switch (t) {
        case 0: return 'var ' + v + '=' + Math.floor(Math.random() * 1000) + ';';
        case 1: return 'var ' + v + '=(function(){return ' + (Math.random() > 0.5 ? 'true' : 'false') + ';})();';
        case 2: var v2 = gv(); return 'var ' + v + '=' + Math.floor(Math.random() * 50) + ',' + v2 + '=' + v + '+' + Math.floor(Math.random() * 50) + ';';
        case 3: return 'try{var ' + v + '=undefined;}catch(' + gv() + '){}';
        default: return 'var ' + v + '=[' + Math.floor(Math.random() * 10) + ',' + Math.floor(Math.random() * 10) + '];';
      }
    }

    var result = [];
    for (var i = 0; i < statements.length; i++) {
      if (Math.random() > 0.5) result.push(ms());
      result.push(statements[i]);
    }
    if (Math.random() > 0.4) result.push(ms());
    return result.join('\n');
  }

  // ========== ANTI-DEBUG ==========

  function addAntiDebug(code) {
    var chk = '_0x' + Math.random().toString(16).substr(2, 4);
    var intv = '_0x' + Math.random().toString(16).substr(2, 4);
    var cnt = '_0x' + Math.random().toString(16).substr(2, 4);
    return '(function(){var ' + cnt + '=0;var ' + chk + '=function(){var _w=window.outerWidth-window.innerWidth>160;var _h=window.outerHeight-window.innerHeight>160;if(_w||_h){' + cnt + '++;if(' + cnt + '>3){console.clear();document.documentElement.innerHTML="";}}};var _origLog=console.log;var _devtools=false;Object.defineProperty(console,"log",{get:function(){_devtools=true;return _origLog;}});var ' + intv + '=setInterval(function(){var _s=performance.now();debugger;if(performance.now()-_s>100){clearInterval(' + intv + ');document.documentElement.innerHTML="";}' + chk + '();},3000);})();\n' + code;
  }

  // ========== MINIFY ==========

  function minify(tokens) {
    var sig = [];
    for (var i = 0; i < tokens.length; i++) {
      if (tokens[i].type !== 'comment' && tokens[i].type !== 'whitespace') sig.push(tokens[i]);
    }

    function isWord(t) { return t.type === 'ident' || t.type === 'number' || t.type === 'code'; }

    var kwSpace = {
      'var':1,'let':1,'const':1,'function':1,'return':1,'typeof':1,
      'instanceof':1,'new':1,'delete':1,'void':1,'throw':1,'case':1,
      'in':1,'of':1,'class':1,'extends':1,'import':1,'export':1,
      'from':1,'as':1,'async':1,'await':1,'yield':1,'else':1,'do':1
    };

    var result = '';
    for (var i = 0; i < sig.length; i++) {
      var tok = sig[i];
      var prev = i > 0 ? sig[i - 1] : null;

      if (prev) {
        var ns = false;
        if (isWord(prev) && isWord(tok)) ns = true;
        if (prev.type === 'ident' && kwSpace[prev.value]) {
          if (tok.value !== '(' && tok.value !== '{' && tok.value !== ';' &&
              tok.value !== ')' && tok.value !== '}') {
            if (isWord(tok) || tok.value === '[' || tok.value === '!' ||
                tok.value === '~' || tok.value === '-' || tok.value === '+' ||
                tok.value === '...' || tok.type === 'string' || tok.type === 'template') {
              ns = true;
            }
          }
        }
        if (prev.value === 'else' && (tok.value === 'if' || tok.value === '{' || isWord(tok))) ns = true;
        if ((prev.value === '+' && (tok.value === '+' || tok.value === '++')) ||
            (prev.value === '++' && (tok.value === '+' || tok.value === '++')) ||
            (prev.value === '-' && (tok.value === '-' || tok.value === '--')) ||
            (prev.value === '--' && (tok.value === '-' || tok.value === '--'))) ns = true;
        if (ns) result += ' ';
      }
      result += tok.value;
    }
    return result;
  }

  // ========== ASSEMBLE ==========

  function tokensToCode(tokens) {
    var r = '';
    for (var i = 0; i < tokens.length; i++) r += tokens[i].value;
    return r;
  }

  // ========== MAIN ==========

  function obfuscate(code, options) {
    obfuscatedVarsCount = 0;
    try {
      var tokens = tokenize(code);
      var stringPrefix = '';

      if (options.rename) tokens = renameIdentifiers(tokens, options.nameFormat);

      if (options.strings) {
        var strResult = obfuscateStrings(tokens);
        stringPrefix = strResult.prefix;
        tokens = strResult.tokens;
      }

      var result = tokensToCode(tokens);
      if (stringPrefix) result = stringPrefix + '\n' + result;
      if (options.deadCode) result = injectDeadCode(result);
      if (options.controlFlow) result = flattenControlFlow(result);
      if (options.antiDebug) result = addAntiDebug(result);

      if (options.compact) {
        var finalTokens = tokenize(result);
        result = minify(finalTokens);
      }

      return { success: true, code: result };
    } catch (e) {
      return { success: false, error: e.message };
    }
  }

  // ========== UI ==========

  function updateInputStats() {
    var len = codeInput.value.length;
    var text = len + ' ' + i18n.characters;
    var el = document.getElementById('input-stats');
    var elM = document.getElementById('input-stats-mobile');
    if (el) el.textContent = text;
    if (elM) elM.textContent = text;
  }

  function updateOutputStats() {
    var len = codeOutput.value.length;
    var text = len + ' ' + i18n.characters;
    var el = document.getElementById('output-stats');
    var elM = document.getElementById('output-stats-mobile');
    if (el) el.textContent = text;
    if (elM) elM.textContent = text;
  }

  function formatBytes(bytes) {
    if (bytes < 1024) return bytes + ' B';
    return (bytes / 1024).toFixed(1) + ' KB';
  }

  function showStats(originalLen, resultLen) {
    document.getElementById('stat-original').textContent = formatBytes(originalLen);
    document.getElementById('stat-result').textContent = formatBytes(resultLen);
    var ratio = ((resultLen - originalLen) / originalLen * 100).toFixed(1);
    var ratioEl = document.getElementById('stat-ratio');
    ratioEl.textContent = (ratio > 0 ? '+' : '') + ratio + '%';
    ratioEl.className = 'text-sm sm:text-lg font-bold ' + (ratio > 0 ? 'text-error' : 'text-success');
    document.getElementById('stat-vars').textContent = obfuscatedVarsCount;
    statsPanel.classList.remove('hidden');
  }

  function getOptions() {
    var mobile = isMobile();

    var level;
    if (mobile) {
      var lm = document.querySelector('input[name="level"]:checked');
      level = lm ? lm.value : 'medium';
    } else {
      var ld = document.querySelector('input[name="level-desktop"]:checked');
      level = ld ? ld.value : 'medium';
    }

    var suffix = mobile ? '-mobile' : '';

    var optRename = document.getElementById('opt-rename' + suffix);
    var optStrings = document.getElementById('opt-strings' + suffix);
    var optCF = document.getElementById('opt-controlflow' + suffix);
    var optDead = document.getElementById('opt-deadcode' + suffix);
    var optAnti = document.getElementById('opt-antidebug' + suffix);
    var optCompact = document.getElementById('opt-compact' + suffix);
    var nameFormat = document.getElementById('name-format' + suffix);

    return {
      rename: optRename ? optRename.checked : true,
      strings: optStrings ? optStrings.checked : true,
      controlFlow: optCF ? optCF.checked : false,
      deadCode: optDead ? optDead.checked : false,
      antiDebug: optAnti ? optAnti.checked : false,
      compact: optCompact ? optCompact.checked : true,
      nameFormat: nameFormat ? nameFormat.value : 'hexadecimal'
    };
  }

  function applyLevel() {
    var mobile = isMobile();
    var level;
    if (mobile) {
      var lm = document.querySelector('input[name="level"]:checked');
      level = lm ? lm.value : 'medium';
    } else {
      var ld = document.querySelector('input[name="level-desktop"]:checked');
      level = ld ? ld.value : 'medium';
    }

    var suffix = mobile ? '-mobile' : '';
    var optRename = document.getElementById('opt-rename' + suffix);
    var optStrings = document.getElementById('opt-strings' + suffix);
    var optCF = document.getElementById('opt-controlflow' + suffix);
    var optDead = document.getElementById('opt-deadcode' + suffix);
    var optAnti = document.getElementById('opt-antidebug' + suffix);

    if (level === 'low') {
      if (optRename) optRename.checked = true;
      if (optStrings) optStrings.checked = false;
      if (optCF) optCF.checked = false;
      if (optDead) optDead.checked = false;
      if (optAnti) optAnti.checked = false;
    } else if (level === 'high') {
      if (optRename) optRename.checked = true;
      if (optStrings) optStrings.checked = true;
      if (optCF) optCF.checked = true;
      if (optDead) optDead.checked = true;
      if (optAnti) optAnti.checked = true;
    }

    syncSettings(mobile);
  }

  // ========== EVENTS ==========

  codeInput.addEventListener('input', updateInputStats);

  obfuscateBtn.addEventListener('click', function() {
    var code = codeInput.value.trim();
    if (!code) {
      alert(i18n.enterCode);
      return;
    }

    obfuscateBtn.disabled = true;
    obfuscateBtn.classList.add('loading');

    setTimeout(function() {
      var options = getOptions();
      var result = obfuscate(code, options);

      if (result.success) {
        codeOutput.value = result.code;
        updateOutputStats();
        showStats(code.length, result.code.length);
      } else {
        codeOutput.value = '// ' + i18n.error + ': ' + result.error;
        statsPanel.classList.add('hidden');
      }

      obfuscateBtn.disabled = false;
      obfuscateBtn.classList.remove('loading');
    }, 50);
  });

  document.getElementById('paste-btn').addEventListener('click', function() {
    navigator.clipboard.readText().then(function(text) {
      codeInput.value = text;
      updateInputStats();
    }).catch(function() {});
  });

  document.getElementById('clear-btn').addEventListener('click', function() {
    codeInput.value = '';
    codeOutput.value = '';
    statsPanel.classList.add('hidden');
    updateInputStats();
    updateOutputStats();
  });

  document.getElementById('copy-btn').addEventListener('click', function() {
    if (!codeOutput.value) return;
    navigator.clipboard.writeText(codeOutput.value).then(function() {
      var btn = document.getElementById('copy-btn');
      btn.innerHTML = '<ion-icon name="checkmark-outline"></ion-icon> ' + i18n.copied;
      setTimeout(function() {
        btn.innerHTML = '<ion-icon name="copy-outline"></ion-icon> <span class="hidden sm:inline">' + i18n.copy + '</span>';
      }, 1500);
    });
  });

  document.getElementById('download-btn').addEventListener('click', function() {
    if (!codeOutput.value) return;
    var blob = new Blob([codeOutput.value], { type: 'application/javascript' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'obfuscated.js';
    a.click();
    URL.revokeObjectURL(url);
  });

  updateInputStats();
})();
</script>

{{ end }}